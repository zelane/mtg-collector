import{r as V,D as ee,w as I,a as te,P as L,o as d,c as m,b as l,d as S,u as s,k as x,F as D,e as F,f as T,v as P,g as se,h as g,t as U,n as oe,p as le,i as ae,j as $,l as q,m as ne,q as re,s as ie}from"./vendor.918b318e.js";const ce=function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))_(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const h of f.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&_(h)}).observe(document,{childList:!0,subtree:!0});function o(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function _(i){if(i.ep)return;i.ep=!0;const f=o(i);fetch(i.href,f)}};ce();var ue=(v,w)=>{const o=v.__vccOpts||v;for(const[_,i]of w)o[_]=i;return o};const p=v=>(le("data-v-5426dfbe"),v=v(),ae(),v),de={id:"window"},me={id:"sidebar"},pe=p(()=>l("h3",null,"View Collection",-1)),fe={class:"filter-group collections"},he=p(()=>l("h3",null,"View Set",-1)),_e={class:"filter-group"},ye=p(()=>l("hr",null,null,-1)),ge=p(()=>l("h3",null,"Colours",-1)),ve={class:"filter-group colours"},we=["data-colour"],be=["value","id"],ke=["for"],Ce=p(()=>l("h3",null,"Rarity",-1)),Se={class:"filter-group rarities"},Ve=["data-rarity"],xe=["onUpdate:modelValue","value","id"],Te=["for"],Ue=p(()=>l("h3",null,"Name",-1)),Me={class:"filter-group"},Ne=p(()=>l("h3",null,"Mana Cost",-1)),Pe={class:"filter-group mana"},Ee=p(()=>l("h3",null,"Keywords",-1)),Le={class:"filter-group"},De=p(()=>l("h3",null,"Types",-1)),Fe={class:"filter-group"},Oe=p(()=>l("h3",null,"Card text",-1)),Ae={class:"filter-group"},Ge=p(()=>l("h3",null,"Set",-1)),Be={class:"filter-group"},je={id:"main"},Re={key:0,class:"upload"},We=p(()=>l("span",null,"+",-1)),Ie=[We],$e={class:"form"},qe=p(()=>l("h3",null,"Name",-1)),Ke=p(()=>l("h3",null,"Format",-1)),ze={key:1,class:"button",for:"file-input"},He=["disabled"],Je={key:3,class:"buttons"},Qe={key:4,class:"progress"},Xe={key:1,class:"cards"},Ye=["src"],Ze=["src"],et=["src"],tt={class:"name"},st={setup(v){const w="https://api.scryfall.com/cards/collection",o=V({show:!1,name:null,file:null,text:null,encoding:null,format:null,active:!1,progress:0,count:0,total:0}),_=new ee("mtg");_.version(1).stores({collections:"&name"});const i={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},f=["mythic","rare","uncommon","common"],h=V({tribes:[],keywords:[],sets:[],allSets:[]}),c=V({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20],allSets:null}),O=V({value:null}),A=async(r,t)=>new Promise(e=>{let a=r;if(a.sort((n,u)=>n.prices.eur?parseFloat(n.prices.eur)<parseFloat(u.prices.eur):!0),t.cardText&&t.cardText!==""){const n=new ne(a,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});a=[],n.search(t.cardText).forEach(u=>{a.push(u.item)})}a=a.filter(n=>{if(!(!t.name||!t.name!=""||n.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(b=>b==="C"?n.color_identity.length===0:(n.color_identity||[]).includes(b))||!t.keywords.every(b=>(n.keywords||[]).includes(b))||!t.tribes.every(b=>(n.type_line.toLowerCase()||"").includes(b.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(n.rarity):!0))return!1;let W=!0;return t.sets.length>0&&(W=t.sets.some(b=>n.set===b)),!(!W||!(n.cmc>=t.mana[0]&&n.cmc<=t.mana[1]))}),e(a.slice(0,200))});let M=[];const y=V({collections:[],value:[]});let k=V({value:""});const K=async r=>{if(r==="")return;let t=await _.collections.get({name:r});G(t.cards)},z=async r=>{let t="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:"e:"+r}),e=[];for(;;){let a=await E(j,t);if(e=e.concat(a.data),!a.has_more)break;t=a.next_page,await new Promise(n=>setTimeout(n,100))}G(e)},G=async r=>{M=r,y.value=await A(M,c);const t=new Set,e=[];M.forEach(a=>{a.keywords.forEach(n=>{t.add(n)}),e[a.set]=a.set_name}),h.keywords=[...t],h.sets=Object.keys(e).map(a=>({set:a,setName:e[a]}))},H=async r=>{await _.collections.delete(r),y.collections.pop(r),k.value=y.collections.length>0?y.collections[0]:""};I(k,r=>K(r.value));let B=null;I(c,async r=>{clearTimeout(B),B=setTimeout(async()=>{y.value=await A(M,r)},500)}),_.collections.toCollection().primaryKeys().then(r=>{r.length!==0&&(y.collections=r,k.value=r[0])});const E=async(r,t)=>{const e=new Request(t);let a=await r.match(e);return a||(await r.add(e),a=await r.match(e)),await a.json()};let j=null;caches.open("cardDataCache").then(async r=>{j=r;let t=await E(r,"https://api.scryfall.com/catalog/creature-types");h.tribes=t.data;let e=await E(r,"https://api.scryfall.com/sets");h.allSets=e.data});const J=async(r="",t={})=>(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),Q=async r=>{let t=await r.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},X=async r=>{o.active=!0,o.progress=0;let t={};if(o.format==="MTGA"){const e=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,a=o.text.matchAll(e);for(const n of a)console.log(n),t[n[3]+n[4]]={name:n[2],count:n[1],set:n[3],number:n[4]}}else if(o.format==="MTGO"){const e=/([0-9]+) (.+)/g,a=o.text.matchAll(e);for(const n of a)console.log(n),t[n[2]]={name:n[2],count:n[1],set:"",number:""}}R(t)},N=te(null),Y=async r=>{if(N.value.files.length===0)return;let t=N.value.files[0];const e=new FileReader;o.active=!0,o.progress=0;let a=null;o.format==="DragonShield Web"&&(a=Z),e.onload=async()=>{let u=await a(e.result);R(u)};let n=await Q(t);console.log(n),e.readAsText(t,n)};L.parsePromise=r=>new Promise((t,e)=>{L.parse(r,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:t,error:e})});const Z=async r=>{r=r.replace('"sep=,"',"");let t=await L.parsePromise(r),e={};return t.data.forEach(a=>{e[a["Set Code"]+a["Card Number"]]={name:a["Card Name"],count:0,set:a["Set Code"],number:a["Card Number"].toString()}}),e},R=async r=>{const t=[];try{Object.keys(r).forEach(n=>{let u=r[n],C={};u.set===""&&u.number===""&&(C.name=u.name),u.set!==""&&(C.set=u.set),u.number!==""&&(C.collector_number=u.number),t.push(C)});let e=[];o.total=t.length;for(let n=0;n<t.length;n+=75){const u=await J(w,{identifiers:t.slice(n,n+75)});e=e.concat(u.data),o.count=n,o.progress=n/t.length*100,await new Promise(C=>setTimeout(C,100))}o.progress=100;let a=o.name;_.collections.put({name:a,cards:e}),y.collections.includes(a)||y.collections.push(a),k.value=a}catch{}finally{o.active=!1,o.count=0,o.progress=0,o.total=0,o.show=!1}};return(r,t)=>(d(),m("div",de,[l("div",me,[pe,l("div",fe,[S(s(x),{modelValue:s(k).value,"onUpdate:modelValue":t[0]||(t[0]=e=>s(k).value=e),options:s(y).collections,mode:"single",canClear:!1},null,8,["modelValue","options"]),l("button",{class:"small add",onClick:t[1]||(t[1]=e=>s(o).show=!0)},"+"),l("button",{class:"small remove",onClick:t[2]||(t[2]=e=>H(s(k).value))},"-")]),he,l("div",_e,[S(s(x),{modelValue:s(O).value,"onUpdate:modelValue":t[3]||(t[3]=e=>s(O).value=e),options:s(h).allSets,label:"name",valueProp:"code",searchable:!0,mode:"single",onSelect:z},null,8,["modelValue","options"])]),ye,ge,l("div",ve,[(d(),m(D,null,F(i,e=>l("div",{class:$(["input-group colour",s(c).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[T(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=a=>s(c).colours=a),value:e,id:e},null,8,be),[[q,s(c).colours]]),l("label",{for:e,class:$("icon icon-"+e)},null,10,ke)],10,we)),64))]),Ce,l("div",Se,[(d(),m(D,null,F(f,e=>l("div",{class:"input-group rarity","data-rarity":e,key:e},[T(l("input",{type:"checkbox","onUpdate:modelValue":a=>s(c).rarity=a,value:e,id:e},null,8,xe),[[q,s(c).rarity]]),l("label",{for:e,class:"icon icon-logo"},null,8,Te)],8,Ve)),64))]),Ue,l("div",Me,[T(l("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>s(c).name=e)},null,512),[[P,s(c).name]])]),Ne,l("div",Pe,[S(s(se),{modelValue:s(c).mana,"onUpdate:modelValue":t[6]||(t[6]=e=>s(c).mana=e),min:0,max:20},null,8,["modelValue"])]),Ee,l("div",Le,[S(s(x),{modelValue:s(c).keywords,"onUpdate:modelValue":t[7]||(t[7]=e=>s(c).keywords=e),options:s(h).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),De,l("div",Fe,[S(s(x),{modelValue:s(c).tribes,"onUpdate:modelValue":t[8]||(t[8]=e=>s(c).tribes=e),options:s(h).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),Oe,l("div",Ae,[T(l("input",{type:"search","onUpdate:modelValue":t[9]||(t[9]=e=>s(c).cardText=e)},null,512),[[P,s(c).cardText]])]),Ge,l("div",Be,[S(s(x),{modelValue:s(c).sets,"onUpdate:modelValue":t[10]||(t[10]=e=>s(c).sets=e),options:s(h).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),l("div",je,[s(o).show?(d(),m("div",Re,[l("button",{class:"small close",onClick:t[11]||(t[11]=e=>s(o).show=!1)},Ie),l("div",$e,[qe,T(l("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s(o).name=e)},null,512),[[P,s(o).name]]),Ke,S(s(x),{modelValue:s(o).format,"onUpdate:modelValue":t[13]||(t[13]=e=>s(o).format=e),options:["DragonShield Web","DragonShield Mobile","MTGA","MTGO"],canClear:!1},null,8,["modelValue"]),["MTGA","MTGO"].includes(s(o).format)?T((d(),m("textarea",{key:0,"onUpdate:modelValue":t[14]||(t[14]=e=>s(o).text=e)},null,512)),[[P,s(o).text]]):g("",!0),["DragonShield Web","DragonShield Mobile"].includes(s(o).format)?(d(),m("label",ze,"Choose file")):g("",!0),s(o).format==="DragonShield Web"?(d(),m("input",{key:2,id:"file-input",ref_key:"fileElem",ref:N,type:"file",disabled:s(o).active},null,8,He)):g("",!0),!s(o).active&&s(o).format&&(s(o).text||N.value)?(d(),m("div",Je,[l("button",{onClick:t[15]||(t[15]=e=>["MTGA","MTGO"].includes(s(o).format)?X():Y())},"Upload")])):g("",!0),s(o).active?(d(),m("div",Qe,[l("span",null,"Processing cards: "+U(s(o).count)+" / "+U(s(o).total),1),l("div",{class:"bar",style:oe({width:s(o).progress+"%"})},null,4)])):g("",!0)])])):g("",!0),s(o).show?g("",!0):(d(),m("div",Xe,[(d(!0),m(D,null,F(s(y).value,e=>(d(),m("div",{class:"card",key:e.id+e.foil},[e.image_uris?(d(),m("img",{key:0,src:e.image_uris.normal},null,8,Ye)):g("",!0),e.card_faces&&e.card_faces[0].image_uris?(d(),m("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Ze)):g("",!0),e.card_faces&&e.card_faces[0].image_uris?(d(),m("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,et)):g("",!0),l("p",tt,U(e.name),1),l("p",null,U(e.set_name),1),l("p",null,U(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))]))])]))}};var ot=ue(st,[["__scopeId","data-v-5426dfbe"]]);const lt={setup(v){return(w,o)=>(d(),re(ot))}},at=ie(lt);at.mount("#app");
