import{r as U,D as le,a as K,w as z,P as F,o as d,c as p,b as l,d as V,u as s,k as T,F as A,e as G,f as L,v as P,g as ae,h as v,t as M,n as ne,p as re,i as ie,j as H,l as J,m as ce,q as ue,s as de}from"./vendor.918b318e.js";const me=function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))y(c);new MutationObserver(c=>{for(const _ of c)if(_.type==="childList")for(const f of _.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&y(f)}).observe(document,{childList:!0,subtree:!0});function o(c){const _={};return c.integrity&&(_.integrity=c.integrity),c.referrerpolicy&&(_.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?_.credentials="include":c.crossorigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function y(c){if(c.ep)return;c.ep=!0;const _=o(c);fetch(c.href,_)}};me();var pe=(g,w)=>{const o=g.__vccOpts||g;for(const[y,c]of w)o[y]=c;return o};const h=g=>(re("data-v-edbf8a3a"),g=g(),ie(),g),fe={id:"window"},he={id:"sidebar"},_e={class:"filter-group collections"},ye=h(()=>l("h3",null,"View Collection",-1)),ve={class:"filter-group"},ge=h(()=>l("h3",null,"View Set",-1)),be=h(()=>l("hr",null,null,-1)),we={class:"filter-group colours"},ke=h(()=>l("h3",null,"Colours",-1)),Ce=["data-colour"],Ve=["value","id"],Se=["for"],xe={class:"filter-group rarities"},Te=h(()=>l("h3",null,"Rarity",-1)),Ue=["data-rarity"],Le=["onUpdate:modelValue","value","id"],Me=["for","title"],Ne={class:"filter-group"},Ee=h(()=>l("h3",null,"Name",-1)),Oe={class:"filter-group mana"},Pe=h(()=>l("h3",null,"Mana Cost",-1)),De={class:"filter-group"},Fe=h(()=>l("h3",null,"Types",-1)),Ae={class:"filter-group"},Ge=h(()=>l("h3",null,"Keywords",-1)),Be={class:"filter-group"},je=h(()=>l("h3",null,"Card text",-1)),Re={class:"filter-group"},We=h(()=>l("h3",null,"Set",-1)),Ie={class:"filter-group"},$e=h(()=>l("h3",null,"Other collection",-1)),qe={id:"main"},Ke={key:0,class:"loader"},ze={key:1,class:"upload"},He=h(()=>l("span",null,"+",-1)),Je=[He],Qe={class:"form"},Xe=h(()=>l("h3",null,"Name",-1)),Ye=h(()=>l("h3",null,"Format",-1)),Ze={key:1,class:"button",for:"file-input"},et=["disabled"],tt={key:3,class:"buttons"},st={key:4,class:"progress"},ot={key:2,class:"cards"},lt=["src"],at=["src"],nt=["src"],rt={class:"name"},it={setup(g){const w="https://api.scryfall.com/cards/collection",o=U({show:!1,name:null,file:null,text:null,encoding:null,format:null,active:!1,progress:0,count:0,total:0}),y=new le("mtg");y.version(1).stores({collections:"&name"});const c={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},_=["special","mythic","rare","uncommon","common"],f=U({tribes:[],keywords:[],sets:[],allSets:[]}),i=U({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20],dupesOnly:!1,collection:""}),B=U({value:null});let N=K(!1);const j=async(n,t)=>new Promise(async e=>{N.value=!0;let a=n;if(a.sort((r,u)=>r.prices.eur?parseFloat(r.prices.eur)<parseFloat(u.prices.eur)?1:-1:!0),t.cardText&&t.cardText!==""){const r=new ce(a,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});a=[],r.search(t.cardText).forEach(u=>{a.push(u.item)})}if(t.collection&&t.collection!==""){const u=(await y.collections.get({name:t.collection})).cards.map(m=>m.oracle_id);a=a.filter(m=>u.includes(m.oracle_id))}a=a.filter(r=>{if(t.dupesOnly&&r.count===1||!(!t.name||!t.name!=""||r.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(C=>C==="C"?r.color_identity.length===0:(r.color_identity||[]).includes(C))||!t.keywords.every(C=>(r.keywords||[]).includes(C))||!t.tribes.every(C=>(r.type_line.toLowerCase()||"").includes(C.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(r.rarity):!0))return!1;let q=!0;return t.sets.length>0&&(q=t.sets.some(C=>r.set===C)),!(!q||!(r.cmc>=t.mana[0]&&r.cmc<=t.mana[1]))}),N.value=!1,e(a.slice(0,500))});let E=[];const b=U({collections:[],value:[]});let S=U({value:""});const Q=async n=>{if(n==="")return;let t=await y.collections.get({name:n});R(t.cards)},X=async n=>{let t="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:"e:"+n}),e=[];N.value=!0;try{for(;;){let a=await D(I,t);if(e=e.concat(a.data),!a.has_more)break;t=a.next_page,await new Promise(r=>setTimeout(r,100))}R(e)}finally{N.value=!1}},R=async n=>{E=n,b.value=await j(E,i);const t=new Set,e=[];E.forEach(a=>{a.keywords.forEach(r=>{t.add(r)}),e[a.set]=a.set_name}),f.keywords=[...t],f.sets=Object.keys(e).map(a=>({set:a,setName:e[a]}))},Y=async n=>{await y.collections.delete(n),b.collections.pop(n),S.value=""};z(S,n=>Q(n.value));let W=null;z(i,async n=>{clearTimeout(W),W=setTimeout(async()=>{b.value=await j(E,n)},500)}),y.collections.toCollection().primaryKeys().then(n=>{n.length!==0&&(b.collections=n,S.value=n[0])});const D=async(n,t)=>{const e=new Request(t);let a=await n.match(e);return a||(await n.add(e),a=await n.match(e)),await a.json()};let I=null;caches.open("cardDataCache").then(async n=>{I=n;let t=await D(n,"https://api.scryfall.com/catalog/creature-types");f.tribes=t.data,f.tribes=f.tribes.concat(["Enchantment","Sorcery","Land","Creature","Instant","Artifact"]),console.log(f.tribes);let e=await D(n,"https://api.scryfall.com/sets");f.allSets=e.data});const Z=async(n="",t={})=>(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),ee=async n=>{let t=await n.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},te=async n=>{o.active=!0,o.progress=0;let t={};if(o.format==="MTGA"){const e=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,a=o.text.matchAll(e);for(const r of a)t[r[3]+r[4]]={name:r[2],count:r[1],set:r[3],number:r[4]}}else if(o.format==="MTGO"){const e=/([0-9]+) (.+)/g,a=o.text.matchAll(e);for(const r of a)t[r[2]]={name:r[2],count:r[1],set:"",number:""}}$(t)},O=K(null),se=async n=>{if(O.value.files.length===0)return;let t=O.value.files[0];const e=new FileReader;o.active=!0,o.progress=0;let a=null;o.format==="DragonShield Web"&&(a=oe),e.onload=async()=>{let u=await a(e.result);$(u)};let r=await ee(t);e.readAsText(t,r)};F.parsePromise=n=>new Promise((t,e)=>{F.parse(n,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:t,error:e})});const oe=async n=>{n=n.replace('"sep=,"',"");let t=await F.parsePromise(n),e={};return t.data.forEach(a=>{e[a["Set Code"]+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:a["Set Code"].toLowerCase(),number:a["Card Number"].toString()}}),e},$=async n=>{const t=[],e={};try{Object.keys(n).forEach(u=>{let m=n[u],x={};m.set===""&&m.number===""?(x.name=m.name,e[m.name]=m.count):(x.set=m.set,x.collector_number=m.number,e[m.set+m.number]=m.count),t.push(x)});let a=[];o.total=t.length;for(let u=0;u<t.length;u+=75){let x=(await Z(w,{identifiers:t.slice(u,u+75)})).data.map(k=>(k.count=e[k.name]||e[k.set+k.collector_number],k));a=a.concat(x),o.count=u,o.progress=u/t.length*100,await new Promise(k=>setTimeout(k,100))}o.progress=100;let r=o.name;y.collections.put({name:r,cards:a}),b.collections.includes(r)||b.collections.push(r),S.value=r}catch{}finally{o.active=!1,o.count=0,o.progress=0,o.total=0,o.show=!1}};return(n,t)=>(d(),p("div",fe,[l("div",he,[l("div",_e,[ye,V(s(T),{modelValue:s(S).value,"onUpdate:modelValue":t[0]||(t[0]=e=>s(S).value=e),options:s(b).collections,mode:"single",canClear:!1},null,8,["modelValue","options"]),l("button",{class:"small add",onClick:t[1]||(t[1]=e=>s(o).show=!0)},"+"),l("button",{class:"small remove",onClick:t[2]||(t[2]=e=>Y(s(S).value))},"-")]),l("div",ve,[ge,V(s(T),{modelValue:s(B).value,"onUpdate:modelValue":t[3]||(t[3]=e=>s(B).value=e),options:s(f).allSets,label:"name",valueProp:"code",searchable:!0,mode:"single",onSelect:X},null,8,["modelValue","options"])]),be,l("div",we,[ke,(d(),p(A,null,G(c,e=>l("div",{class:H(["input-group colour",s(i).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[L(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=a=>s(i).colours=a),value:e,id:e},null,8,Ve),[[J,s(i).colours]]),l("label",{for:e,class:H("icon icon-"+e)},null,10,Se)],10,Ce)),64))]),l("div",xe,[Te,(d(),p(A,null,G(_,e=>l("div",{class:"input-group rarity","data-rarity":e,key:e},[L(l("input",{type:"checkbox","onUpdate:modelValue":a=>s(i).rarity=a,value:e,id:e},null,8,Le),[[J,s(i).rarity]]),l("label",{for:e,title:e},null,8,Me)],8,Ue)),64))]),l("div",Ne,[Ee,L(l("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>s(i).name=e)},null,512),[[P,s(i).name]])]),l("div",Oe,[Pe,V(s(ae),{modelValue:s(i).mana,"onUpdate:modelValue":t[6]||(t[6]=e=>s(i).mana=e),min:0,max:20},null,8,["modelValue"])]),l("div",De,[Fe,V(s(T),{modelValue:s(i).tribes,"onUpdate:modelValue":t[7]||(t[7]=e=>s(i).tribes=e),options:s(f).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),l("div",Ae,[Ge,V(s(T),{modelValue:s(i).keywords,"onUpdate:modelValue":t[8]||(t[8]=e=>s(i).keywords=e),options:s(f).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),l("div",Be,[je,L(l("input",{type:"search","onUpdate:modelValue":t[9]||(t[9]=e=>s(i).cardText=e)},null,512),[[P,s(i).cardText]])]),l("div",Re,[We,V(s(T),{modelValue:s(i).sets,"onUpdate:modelValue":t[10]||(t[10]=e=>s(i).sets=e),options:s(f).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),l("div",Ie,[$e,V(s(T),{modelValue:s(i).collection,"onUpdate:modelValue":t[11]||(t[11]=e=>s(i).collection=e),options:s(b).collections,mode:"single"},null,8,["modelValue","options"])])]),l("div",qe,[s(N)?(d(),p("div",Ke,"Loading")):v("",!0),s(o).show?(d(),p("div",ze,[l("button",{class:"small close",onClick:t[12]||(t[12]=e=>s(o).show=!1)},Je),l("div",Qe,[Xe,L(l("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>s(o).name=e)},null,512),[[P,s(o).name]]),Ye,V(s(T),{modelValue:s(o).format,"onUpdate:modelValue":t[14]||(t[14]=e=>s(o).format=e),options:["DragonShield Web","DragonShield Mobile","MTGA","MTGO"],canClear:!1},null,8,["modelValue"]),["MTGA","MTGO"].includes(s(o).format)?L((d(),p("textarea",{key:0,"onUpdate:modelValue":t[15]||(t[15]=e=>s(o).text=e)},null,512)),[[P,s(o).text]]):v("",!0),["DragonShield Web","DragonShield Mobile"].includes(s(o).format)?(d(),p("label",Ze,"Choose file")):v("",!0),s(o).format==="DragonShield Web"?(d(),p("input",{key:2,id:"file-input",ref_key:"fileElem",ref:O,type:"file",disabled:s(o).active},null,8,et)):v("",!0),!s(o).active&&s(o).format&&(s(o).text||O.value)?(d(),p("div",tt,[l("button",{onClick:t[16]||(t[16]=e=>["MTGA","MTGO"].includes(s(o).format)?te():se())},"Upload")])):v("",!0),s(o).active?(d(),p("div",st,[l("span",null,"Processing cards: "+M(s(o).count)+" / "+M(s(o).total),1),l("div",{class:"bar",style:ne({width:s(o).progress+"%"})},null,4)])):v("",!0)])])):v("",!0),s(o).show?v("",!0):(d(),p("div",ot,[(d(!0),p(A,null,G(s(b).value,e=>(d(),p("div",{class:"card",key:e.id+e.foil},[e.image_uris?(d(),p("img",{key:0,src:e.image_uris.normal},null,8,lt)):v("",!0),e.card_faces&&e.card_faces[0].image_uris?(d(),p("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,at)):v("",!0),e.card_faces&&e.card_faces[0].image_uris?(d(),p("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,nt)):v("",!0),l("p",rt,M(e.count)+" "+M(e.name),1),l("p",null,M(e.set_name),1),l("p",null,M(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))]))])]))}};var ct=pe(it,[["__scopeId","data-v-edbf8a3a"]]);const ut={setup(g){return(w,o)=>(d(),ue(ct))}},dt=de(ut);dt.mount("#app");
