import{r as L,D as ue,a as H,w as Q,P as B,o as m,c as p,b as s,d as x,u as o,k as E,F,e as D,f as U,v as $,g as J,h as C,t as V,n as X,p as de,i as me,j as Y,l as A,m as pe,q as fe,s as _e}from"./vendor.918b318e.js";const he=function(){const T=document.createElement("link").relList;if(T&&T.supports&&T.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))v(u);new MutationObserver(u=>{for(const y of u)if(y.type==="childList")for(const h of y.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&v(h)}).observe(document,{childList:!0,subtree:!0});function n(u){const y={};return u.integrity&&(y.integrity=u.integrity),u.referrerpolicy&&(y.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?y.credentials="include":u.crossorigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function v(u){if(u.ep)return;u.ep=!0;const y=n(u);fetch(u.href,y)}};he();var ye=(k,T)=>{const n=k.__vccOpts||k;for(const[v,u]of T)n[v]=u;return n};const _=k=>(de("data-v-c7e34e68"),k=k(),me(),k),ve={id:"window"},ge={id:"sidebar"},be={class:"filter-group collections"},Ce=_(()=>s("h3",null,"View Collection",-1)),we={class:"filter-group"},ke=_(()=>s("h3",null,"View Set",-1)),xe=_(()=>s("hr",null,null,-1)),Ve={class:"filter-group colours"},Te=_(()=>s("h3",null,"Colours",-1)),Se=["data-colour"],Ue=["value","id"],Ne=["for"],Ee={class:"filter-group rarities"},Le=_(()=>s("h3",null,"Rarity",-1)),Me=["data-rarity"],Fe=["onUpdate:modelValue","value","id"],Oe=["for","title"],Pe={class:"filter-group"},De=_(()=>s("h3",null,"Name",-1)),$e={class:"filter-group mana"},Ae=_(()=>s("h3",null,"Mana Cost",-1)),Ge={class:"filter-group"},Be=_(()=>s("h3",null,"Types",-1)),je={class:"filter-group"},Ie=_(()=>s("h3",null,"Keywords",-1)),Re={class:"filter-group"},We=_(()=>s("h3",null,"Card text",-1)),ze={class:"filter-group"},qe=_(()=>s("h3",null,"Set",-1)),Ke={class:"filter-group compare"},He=_(()=>s("h3",null,"Compare",-1)),Qe={class:"grid"},Je=["id","onUpdate:modelValue"],Xe=["for"],Ye=["id","onUpdate:modelValue"],Ze=["for"],et={id:"main"},tt={key:0,class:"loader"},ot={key:1,class:"upload"},st=_(()=>s("span",null,"+",-1)),lt=[st],nt={class:"form"},at=_(()=>s("h3",null,"Name",-1)),rt=_(()=>s("h3",null,"Format",-1)),it={key:1,class:"button",for:"file-input"},ct=["disabled"],ut={key:3,class:"buttons"},dt={key:4,class:"progress"},mt={class:"info-bar"},pt=["src"],ft=["src"],_t=["src"],ht={class:"name"},yt={setup(k){const T="https://api.scryfall.com/cards/collection",n=L({show:!1,name:null,file:null,text:null,encoding:null,format:null,active:!1,progress:0,count:0,total:0}),v=new ue("mtg");v.version(1).stores({collections:"&name"});const u={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},y=["special","mythic","rare","uncommon","common"],h=L({tribes:[],keywords:[],sets:[],allSets:[]}),c=L({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20],dupesOnly:!1,sort:"Price",incCol:{},excCol:{}}),Z=["Mana","Price","Count"],g=L({count:0,total_value:0,zoom:0}),j=new Set;let M=H(!1);const ee=(l,t)=>{if(c.sort==="Price")return l.price?l.price<t.price?1:-1:!0;if(c.sort==="Mana")return parseFloat(l.cmc)<parseFloat(t.cmc)?1:-1;if(c.sort==="Count")return parseFloat(l.count)<parseFloat(t.count)?1:-1},I=async(l,t)=>new Promise(async e=>{let a=setTimeout(()=>M.value=!0,300),r=l.sort(ee);if(t.cardText&&t.cardText!==""){const i=new pe(r,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});r=[],i.search(t.cardText).forEach(d=>{r.push(d.item)})}for(const i of Object.keys(t.incCol)){if(!t.incCol[i])continue;const b=(await v.collections.get({name:i})).cards.map(f=>f.oracle_id);r=r.filter(f=>b.includes(f.oracle_id))}for(const i of Object.keys(t.excCol)){if(!t.excCol[i])continue;const b=(await v.collections.get({name:i})).cards.map(f=>f.oracle_id);r=r.filter(f=>!b.includes(f.oracle_id))}g.count=0,g.total_value=0,r=r.filter(i=>{if(t.dupesOnly&&i.count===1||!(!t.name||!t.name!=""||i.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(S=>S==="C"?i.color_identity.length===0:(i.color_identity||[]).includes(S))||!t.keywords.every(S=>(i.keywords||[]).includes(S))||!t.tribes.every(S=>(i.type_line.toLowerCase()||"").includes(S.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(i.rarity):!0))return!1;let K=!0;return t.sets.length>0&&(K=t.sets.some(S=>i.set===S)),!K||!(i.cmc>=t.mana[0]&&i.cmc<=t.mana[1])?!1:(g.total_value+=i.price,!0)}),g.total_value=parseInt(g.total_value),g.count=r.length,clearTimeout(a),M.value=!1,e(r.slice(0,250))});let O=[];const w=L({collections:[],value:[]});let N=L({value:""});const te=async l=>{if(l==="")return;let t=await v.collections.get({name:l});R(t.cards)},oe=async l=>{let t="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:"e:"+l,unique:"prints"}),e=[];M.value=!0;try{for(;;){let a=await G(z,t);if(e=e.concat(a.data),!a.has_more)break;t=a.next_page,await new Promise(r=>setTimeout(r,100))}R(e)}finally{M.value=!1}},R=async l=>{O=l;const t=new Set,e=[];let a=.9;O.forEach(r=>{r.price=parseFloat(r.prices.eur||parseFloat(r.prices.usd)*a||0),r.keywords.forEach(i=>{t.add(i)}),e[r.set]=r.set_name}),h.keywords=[...t],h.sets=Object.keys(e).map(r=>({set:r,setName:e[r]})),w.value=await I(O,c)},se=async l=>{await v.collections.delete(l),w.collections.pop(l),N.value=""};Q(N,l=>te(l.value));let W=null;Q(c,async l=>{clearTimeout(W),W=setTimeout(async()=>{w.value=await I(O,l)},500)}),v.collections.toCollection().primaryKeys().then(l=>{l.length!==0&&(w.collections=l.sort(),N.value=l[0])});const G=async(l,t)=>{const e=new Request(t);let a=await l.match(e);return a||(await l.add(e),a=await l.match(e)),await a.json()};let z=null;caches.open("cardDataCache").then(async l=>{z=l;let t=await G(l,"https://api.scryfall.com/catalog/creature-types");h.tribes=t.data,h.tribes=h.tribes.concat(["Enchantment","Sorcery","Land","Creature","Instant","Artifact"]);let e=await G(l,"https://api.scryfall.com/sets");e.data.forEach(a=>j.add(a.code)),h.allSets=e.data});const le=async(l="",t={})=>(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),ne=async l=>{let t=await l.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},ae=async l=>{n.active=!0,n.progress=0;let t={};if(n.format==="MTGA"){const e=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,a=n.text.matchAll(e);for(const r of a)t[r[3]+r[4]]={name:r[2],count:r[1],set:r[3],number:r[4]}}else if(n.format==="MTGO"){const e=/([0-9]+) (.+)/g,a=n.text.matchAll(e);for(const r of a)t[r[2]]={name:r[2],count:r[1],set:"",number:""}}q(t)},P=H(null),re=async l=>{if(P.value.files.length===0)return;let t=P.value.files[0];const e=new FileReader;n.active=!0,n.progress=0;let a=null;n.format==="DragonShield Web"&&(a=ie),e.onload=async()=>{let i=await a(e.result);q(i)};let r=await ne(t);e.readAsText(t,r)};B.parsePromise=l=>new Promise((t,e)=>{B.parse(l,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:t,error:e})});const ie=async l=>{l=l.replace('"sep=,"',"");let t=await B.parsePromise(l),e={};return t.data.forEach(a=>{const r=a["Set Name"];let i=a["Set Code"].toLowerCase();j.has(i)?e[i+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:i,number:a["Card Number"].toString()}:(console.log(`Couldn't find set for ${a["Card Name"]} ${a["Card Number"]} ${r} [${i}]`),e[i+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:"",number:""})}),e},q=async l=>{const t=[],e={};try{Object.keys(l).forEach(i=>{let d=l[i],b={};d.set===""&&d.number===""?(b.name=d.name,e[d.name]=d.count):(b.set=d.set,b.collector_number=d.number,e[d.set+d.number]=d.count),t.push(b)});let a=[];n.total=t.length;for(let i=0;i<t.length;i+=75){const d=await le(T,{identifiers:t.slice(i,i+75)});d.not_found.length>0&&console.log(d.not_found);let b=d.data.map(f=>(f.count=e[f.name]||e[f.set+f.collector_number],f));a=a.concat(b),n.count=i,n.progress=i/t.length*100,await new Promise(f=>setTimeout(f,100))}n.progress=100;let r=n.name;v.collections.put({name:r,cards:a}),w.collections.includes(r)||w.collections.push(r),N.value=r}catch{}finally{n.active=!1,n.count=0,n.progress=0,n.total=0,n.show=!1}},ce=async l=>{let t=`"Count","Tradelist Count","Name","Edition","Condition","Language","Foil","Tags","Last Modified","Collector Number"
`;w.value.forEach(e=>{t+=`"${e.count}","0","${e.name}","${e.set}","Near Mint","English","","","2022-03-22 02:52:33.210000","${e.collector_number}"
`}),navigator.clipboard.writeText(t)};return(l,t)=>(m(),p("div",ve,[s("div",ge,[s("div",be,[Ce,x(o(E),{modelValue:o(N).value,"onUpdate:modelValue":t[0]||(t[0]=e=>o(N).value=e),options:o(w).collections,mode:"single","can-clear":!1},null,8,["modelValue","options"]),s("button",{class:"small add",onClick:t[1]||(t[1]=e=>o(n).show=!0)}," + "),s("button",{class:"small remove",onClick:t[2]||(t[2]=e=>se(o(N).value))}," - ")]),s("div",we,[ke,x(o(E),{options:o(h).allSets,label:"name","value-prop":"code",searchable:!0,mode:"single",onSelect:oe},null,8,["options"])]),xe,s("div",Ve,[Te,(m(),p(F,null,D(u,e=>s("div",{class:Y(["input-group colour",o(c).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[U(s("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=a=>o(c).colours=a),value:e,id:e},null,8,Ue),[[A,o(c).colours]]),s("label",{for:e,class:Y("icon icon-"+e)},null,10,Ne)],10,Se)),64))]),s("div",Ee,[Le,(m(),p(F,null,D(y,e=>s("div",{class:"input-group rarity","data-rarity":e,key:e},[U(s("input",{type:"checkbox","onUpdate:modelValue":a=>o(c).rarity=a,value:e,id:e},null,8,Fe),[[A,o(c).rarity]]),s("label",{for:e,title:e},null,8,Oe)],8,Me)),64))]),s("div",Pe,[De,U(s("input",{type:"search","onUpdate:modelValue":t[4]||(t[4]=e=>o(c).name=e)},null,512),[[$,o(c).name]])]),s("div",$e,[Ae,x(o(J),{modelValue:o(c).mana,"onUpdate:modelValue":t[5]||(t[5]=e=>o(c).mana=e),min:0,max:20},null,8,["modelValue"])]),s("div",Ge,[Be,x(o(E),{modelValue:o(c).tribes,"onUpdate:modelValue":t[6]||(t[6]=e=>o(c).tribes=e),options:o(h).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),s("div",je,[Ie,x(o(E),{modelValue:o(c).keywords,"onUpdate:modelValue":t[7]||(t[7]=e=>o(c).keywords=e),options:o(h).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),s("div",Re,[We,U(s("input",{type:"search","onUpdate:modelValue":t[8]||(t[8]=e=>o(c).cardText=e)},null,512),[[$,o(c).cardText]])]),s("div",ze,[qe,x(o(E),{modelValue:o(c).sets,"onUpdate:modelValue":t[9]||(t[9]=e=>o(c).sets=e),options:o(h).sets,label:"setName","value-prop":"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),s("div",Ke,[He,s("div",Qe,[(m(!0),p(F,null,D(o(w).collections,e=>(m(),p(F,{key:e},[s("div",null,V(e),1),s("div",null,[U(s("input",{type:"checkbox",id:e+"-inc","onUpdate:modelValue":a=>o(c).incCol[e]=a,value:!1},null,8,Je),[[A,o(c).incCol[e]]]),s("label",{class:"inc",for:e+"-inc"},null,8,Xe)]),s("div",null,[U(s("input",{type:"checkbox",id:e+"-exc","onUpdate:modelValue":a=>o(c).excCol[e]=a,value:!1},null,8,Ye),[[A,o(c).excCol[e]]]),s("label",{class:"exc",for:e+"-exc"},null,8,Ze)])],64))),128))])])]),s("div",et,[o(M)?(m(),p("div",tt," Loading ")):C("",!0),o(n).show?(m(),p("div",ot,[s("button",{class:"small close",onClick:t[10]||(t[10]=e=>o(n).show=!1)},lt),s("div",nt,[at,U(s("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>o(n).name=e)},null,512),[[$,o(n).name]]),rt,x(o(E),{modelValue:o(n).format,"onUpdate:modelValue":t[12]||(t[12]=e=>o(n).format=e),options:["DragonShield Web","DragonShield Mobile","MTGA","MTGO"],"can-clear":!1},null,8,["modelValue"]),["MTGA","MTGO"].includes(o(n).format)?U((m(),p("textarea",{key:0,"onUpdate:modelValue":t[13]||(t[13]=e=>o(n).text=e)},null,512)),[[$,o(n).text]]):C("",!0),["DragonShield Web","DragonShield Mobile"].includes(o(n).format)?(m(),p("label",it,"Choose file")):C("",!0),o(n).format==="DragonShield Web"?(m(),p("input",{key:2,id:"file-input",ref_key:"fileElem",ref:P,type:"file",disabled:o(n).active},null,8,ct)):C("",!0),!o(n).active&&o(n).format&&(o(n).text||P.value)?(m(),p("div",ut,[s("button",{onClick:t[14]||(t[14]=e=>["MTGA","MTGO"].includes(o(n).format)?ae():re())}," Upload ")])):C("",!0),o(n).active?(m(),p("div",dt,[s("span",null,"Processing cards: "+V(o(n).count)+" / "+V(o(n).total),1),s("div",{class:"bar",style:X({width:o(n).progress+"%"})},null,4)])):C("",!0)])])):C("",!0),s("div",mt,[s("span",null,"Count: "+V(o(g).count),1),s("span",null,"Total Value: "+V(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(o(g).total_value)),1),s("span",null,[x(o(E),{modelValue:o(c).sort,"onUpdate:modelValue":t[15]||(t[15]=e=>o(c).sort=e),options:Z,mode:"single","can-clear":!1},null,8,["modelValue"])]),s("span",null,[x(o(J),{min:-5,max:5,modelValue:o(g).zoom,"onUpdate:modelValue":t[16]||(t[16]=e=>o(g).zoom=e)},null,8,["modelValue"])]),s("span",null,[s("button",{onClick:ce},"Export")])]),o(n).show?C("",!0):(m(),p("div",{key:2,class:"cards",style:X({"font-size":18+o(g).zoom*2+"px"})},[(m(!0),p(F,null,D(o(w).value,e=>(m(),p("div",{class:"card",key:e.id+e.foil},[e.image_uris?(m(),p("img",{key:0,src:e.image_uris.normal},null,8,pt)):C("",!0),e.card_faces&&e.card_faces[0].image_uris?(m(),p("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,ft)):C("",!0),e.card_faces&&e.card_faces[0].image_uris?(m(),p("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,_t)):C("",!0),s("p",ht,V(e.count)+" "+V(e.name),1),s("p",null,V(e.set_name),1),s("p",null,V(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.price)),1)]))),128))],4))])]))}};var vt=ye(yt,[["__scopeId","data-v-c7e34e68"]]);const gt={setup(k){return(T,n)=>(m(),fe(vt))}},bt=_e(gt);bt.mount("#app");
