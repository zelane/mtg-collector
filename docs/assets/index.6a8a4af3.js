import{r as $,a as V,D as z,w as H,o as p,c as _,b as s,u as o,d as C,t as b,n as J,F as N,e as U,f as S,v as R,g as L,k as B,p as Q,h as X,i as Y,P as Z,j as ee,l as j,m as D,q as te,s as se}from"./vendor.265ebe75.js";const oe=function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const k of d.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&n(k)}).observe(document,{childList:!0,subtree:!0});function y(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(a){if(a.ep)return;a.ep=!0;const d=y(a);fetch(a.href,d)}};oe();var re=(m,h)=>{const y=m.__vccOpts||m;for(const[n,a]of h)y[n]=a;return y};const g=m=>(Q("data-v-4dc24c75"),m=m(),X(),m),ae={id:"window"},le={id:"sidebar"},ne={key:0,for:"upload"},ie={key:1,class:"progress"},ce=g(()=>s("br",null,null,-1)),ue=g(()=>s("h3",null,"Colours",-1)),de={class:"filter-group colours"},pe=["data-colour"],_e=["value","id"],me=["for"],ye=g(()=>s("h3",null,"Rarity",-1)),he={class:"filter-group rarities"},fe=["data-rarity"],ge=["onUpdate:modelValue","value","id"],ve=["for"],we=g(()=>s("h3",null,"Name",-1)),be={class:"filter-group"},ke=g(()=>s("h3",null,"Keywords",-1)),Ce={class:"filter-group"},xe=g(()=>s("h3",null,"Types",-1)),Ve={class:"filter-group"},Se=g(()=>s("h3",null,"Card text",-1)),Te={class:"filter-group"},Ne=g(()=>s("h3",null,"Set",-1)),Ue={class:"filter-group"},Le={id:"main"},Be={class:"cards"},Fe=["src"],Pe=["src"],Ee=["src"],Oe={class:"name"},Re={props:{},setup(m){const h="https://api.scryfall.com/cards/collection",y=$(null);let n=V({active:!1,progress:0,count:0,total:0});const a=new z("mtg");a.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const d={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},k=["mythic","rare","uncommon","common"];let w=V({tribes:[],keywords:[],sets:[]}),i=V({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[]});const F=async(l,t)=>new Promise((e,c)=>{let r=l;if(r.sort((u,v)=>u.prices.eur?parseFloat(u.prices.eur)<parseFloat(v.prices.eur):!0),t.cardText&&t.cardText!=""){const u=new Y(r,{ignoreLocation:!0,threshold:.5,keys:["oracle_text","card_faces.oracle_text"]});r=[],u.search(t.cardText).forEach(v=>{r.push(v.item)})}r=r.filter(u=>{const v=!t.name||!t.name!=""||u.name.toLowerCase().includes(t.name.toLowerCase()),W=t.colours.every(f=>f=="C"?u.color_identity.length==0:(u.color_identity||[]).includes(f)),G=t.keywords.every(f=>(u.keywords||[]).includes(f)),K=t.tribes.every(f=>(u.type_line.toLowerCase()||"").includes(f.toLowerCase())),M=t.rarity.length>0?[...t.rarity].includes(u.rarity):!0;let O=!0;return t.sets.length>0&&(O=t.sets.some(f=>u.set==f)),W&&G&&K&&M&&v&&O}),e(r.slice(0,200))});let x=[],T=V({value:[]});a.cards.toArray().then(l=>E(l));let P=null;H(i,async l=>{clearTimeout(P),P=setTimeout(async()=>{T.value=await F(x,l)},500)}),caches.open("cardDataCache").then(async l=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await l.match(t);e||(await l.add(t),e=await l.match(t));const c=await e.json();w.tribes=c.data});const E=async l=>{x=l,T.value=await F(x,i);let t=new Set,e=[];x.forEach(c=>{c.keywords.forEach(r=>{t.add(r)}),e[c.set]=c.set_name}),w.keywords=[...t],w.sets=Object.keys(e).map(c=>({set:c,setName:e[c]}))};async function A(l="",t={}){return(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const I=async()=>{const l=new FileReader;n.active=!0,n.progress=0,l.onload=t=>{let e=l.result.replace('"sep=,"',"");Z.parse(e,{header:!0,worker:!0,skipEmptyLines:!0,complete:q})},ee(y.value.files[0]).then(t=>{l.readAsText(y.value.files[0],t.encoding)})},q=async l=>{console.log(l);let t=new Set,e=[];l.data.forEach(r=>{let u=r["Set Code"]+r["Card Number"].toString();t.has(u)||e.push({set:r["Set Code"],collector_number:r["Card Number"].toString()}),t.add(u)});let c=[];n.total=e.length;for(let r=0;r<e.length;r+=75){let u=await A(h,{identifiers:e.slice(r,r+75)});c=c.concat(u.data),n.count=r,n.progress=r/e.length*100,await new Promise(v=>setTimeout(v,100))}n.progress=100,await a.cards.clear(),a.cards.bulkAdd(c),E(c),n.active=!1,n.progress=0,n.total=0};return(l,t)=>(p(),_("div",ae,[s("div",le,[o(n).active?C("",!0):(p(),_("label",ne,"Upload CSV")),s("input",{id:"upload",ref_key:"file",ref:y,onChange:t[0]||(t[0]=e=>I()),type:"file"},null,544),o(n).active?(p(),_("div",ie,[s("span",null,"Processing cards: "+b(o(n).count)+" / "+b(o(n).total),1),s("div",{class:"bar",style:J({width:o(n).progress+"%"})},null,4)])):C("",!0),ce,ue,s("div",de,[(p(),_(N,null,U(d,(e,c)=>s("div",{class:j(["input-group colour",o(i).colours.includes(e)?"selected":""]),"data-colour":e,key:"code"},[S(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=r=>o(i).colours=r),value:e,id:e},null,8,_e),[[D,o(i).colours]]),s("label",{for:e,class:j("icon icon-"+e)},null,10,me)],10,pe)),64))]),ye,s("div",he,[(p(),_(N,null,U(k,e=>s("div",{class:"input-group rarity","data-rarity":e,key:"code"},[S(s("input",{type:"checkbox","onUpdate:modelValue":c=>o(i).rarity=c,value:e,id:e},null,8,ge),[[D,o(i).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,ve)],8,fe)),64))]),we,s("div",be,[S(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>o(i).name=e)},null,512),[[R,o(i).name]])]),ke,s("div",Ce,[L(o(B),{modelValue:o(i).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).keywords=e),options:o(w).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),xe,s("div",Ve,[L(o(B),{modelValue:o(i).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(i).tribes=e),options:o(w).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),Se,s("div",Te,[S(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(i).cardText=e)},null,512),[[R,o(i).cardText]])]),Ne,s("div",Ue,[L(o(B),{modelValue:o(i).sets,"onUpdate:modelValue":t[6]||(t[6]=e=>o(i).sets=e),options:o(w).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),s("div",Le,[s("div",Be,[(p(!0),_(N,null,U(o(T).value,e=>(p(),_("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),_("img",{key:0,src:e.image_uris.normal},null,8,Fe)):C("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Pe)):C("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Ee)):C("",!0),s("p",Oe,b(e.name),1),s("p",null,b(e.set_name)+" ["+b(e.set)+"]",1),s("p",null,b(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var je=re(Re,[["__scopeId","data-v-4dc24c75"]]);const De={setup(m){return(h,y)=>(p(),te(je))}};let Ae=se(De);Ae.mount("#app");
