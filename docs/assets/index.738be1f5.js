import{r as M,a as S,D as $,w as z,o as p,c as _,b as s,u as o,d as x,t as b,n as H,F as U,e as L,f as T,v as O,g as B,k as F,p as J,h as Q,i as X,P as Y,j as Z,l as R,m as j,q as ee,s as te}from"./vendor.265ebe75.js";const se=function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const k of d.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&l(k)}).observe(document,{childList:!0,subtree:!0});function y(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(a){if(a.ep)return;a.ep=!0;const d=y(a);fetch(a.href,d)}};se();var oe=(m,h)=>{const y=m.__vccOpts||m;for(const[l,a]of h)y[l]=a;return y};const g=m=>(J("data-v-17ad836f"),m=m(),Q(),m),re={id:"window"},ae={id:"sidebar"},le={key:0,for:"upload"},ne={key:1,class:"progress"},ie=g(()=>s("br",null,null,-1)),ce=g(()=>s("h3",null,"Colours",-1)),ue={class:"filter-group colours"},de=["data-colour"],pe=["value","id"],_e=["for"],me=g(()=>s("h3",null,"Rarity",-1)),ye={class:"filter-group rarities"},he=["data-rarity"],fe=["onUpdate:modelValue","value","id"],ge=["for"],ve=g(()=>s("h3",null,"Name",-1)),we={class:"filter-group"},be=g(()=>s("h3",null,"Keywords",-1)),ke={class:"filter-group"},Ce=g(()=>s("h3",null,"Types",-1)),xe={class:"filter-group"},Ve=g(()=>s("h3",null,"Card text",-1)),Se={class:"filter-group"},Te=g(()=>s("h3",null,"Set",-1)),Ne={class:"filter-group"},Ue={id:"main"},Le={class:"cards"},Be=["src"],Fe=["src"],Pe=["src"],Ee={class:"name"},Oe={props:{},setup(m){const h="https://api.scryfall.com/cards/collection",y=M(null);let l=S({active:!1,progress:0,count:0,total:0});const a=new $("mtg");a.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const d={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},k=["mythic","rare","uncommon","common"];let w=S({tribes:[],keywords:[],sets:[]}),i=S({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[]});const N=async(n,t)=>new Promise((e,c)=>{let r=n;if(r.sort((u,v)=>u.prices.eur?parseFloat(u.prices.eur)<parseFloat(v.prices.eur):!0),t.cardText&&t.cardText!=""){const u=new X(r,{ignoreLocation:!0,threshold:.5,keys:["oracle_text","card_faces.oracle_text"]});r=[],u.search(t.cardText).forEach(v=>{r.push(v.item)})}r=r.filter(u=>{const v=!t.name||!t.name!=""||u.name.toLowerCase().includes(t.name.toLowerCase()),q=t.colours.every(f=>f=="C"?u.color_identity.length==0:(u.color_identity||[]).includes(f)),W=t.keywords.every(f=>(u.keywords||[]).includes(f)),G=t.tribes.every(f=>(u.type_line.toLowerCase()||"").includes(f.toLowerCase())),K=t.rarity.length>0?[...t.rarity].includes(u.rarity):!0;let E=!0;return t.sets.length>0&&(E=t.sets.some(f=>u.set==f)),q&&W&&G&&K&&v&&E}),e(r.slice(0,200))});let C=[],V=S({value:[]});a.cards.toArray().then(async n=>{C=n,V.value=await N(C,i);let t=new Set,e=[];C.forEach(c=>{c.keywords.forEach(r=>{t.add(r)}),e[c.set]=c.set_name}),w.keywords=[...t],w.sets=Object.keys(e).map(c=>({set:c,setName:e[c]}))});let P=null;z(i,async n=>{clearTimeout(P),P=setTimeout(async()=>{V.value=await N(C,n)},500)}),caches.open("cardDataCache").then(async n=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await n.match(t);e||(await n.add(t),e=await n.match(t));const c=await e.json();w.tribes=c.data});async function D(n="",t={}){return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const A=async()=>{const n=new FileReader;l.active=!0,l.progress=0,n.onload=t=>{let e=n.result.replace('"sep=,"',"");Y.parse(e,{header:!0,worker:!0,skipEmptyLines:!0,complete:I})},Z(y.value.files[0]).then(t=>{n.readAsText(y.value.files[0],t.encoding)})},I=async n=>{console.log(n);let t=new Set,e=[];n.data.forEach(r=>{let u=r["Set Code"]+r["Card Number"].toString();t.has(u)||e.push({set:r["Set Code"],collector_number:r["Card Number"].toString()}),t.add(u)});let c=[];l.total=e.length;for(let r=0;r<e.length;r+=75){let u=await D(h,{identifiers:e.slice(r,r+75)});c=c.concat(u.data),l.count=r,l.progress=r/e.length*100,await new Promise(v=>setTimeout(v,100))}l.progress=100,await a.cards.clear(),a.cards.bulkAdd(c),C=c,V.value=await N(c,i),l.active=!1,l.progress=0,l.total=0};return(n,t)=>(p(),_("div",re,[s("div",ae,[o(l).active?x("",!0):(p(),_("label",le,"Upload CSV")),s("input",{id:"upload",ref_key:"file",ref:y,onChange:t[0]||(t[0]=e=>A()),type:"file"},null,544),o(l).active?(p(),_("div",ne,[s("span",null,"Processing cards: "+b(o(l).count)+" / "+b(o(l).total),1),s("div",{class:"bar",style:H({width:o(l).progress+"%"})},null,4)])):x("",!0),ie,ce,s("div",ue,[(p(),_(U,null,L(d,(e,c)=>s("div",{class:R(["input-group colour",o(i).colours.includes(e)?"selected":""]),"data-colour":e,key:"code"},[T(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=r=>o(i).colours=r),value:e,id:e},null,8,pe),[[j,o(i).colours]]),s("label",{for:e,class:R("icon icon-"+e)},null,10,_e)],10,de)),64))]),me,s("div",ye,[(p(),_(U,null,L(k,e=>s("div",{class:"input-group rarity","data-rarity":e,key:"code"},[T(s("input",{type:"checkbox","onUpdate:modelValue":c=>o(i).rarity=c,value:e,id:e},null,8,fe),[[j,o(i).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,ge)],8,he)),64))]),ve,s("div",we,[T(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>o(i).name=e)},null,512),[[O,o(i).name]])]),be,s("div",ke,[B(o(F),{modelValue:o(i).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).keywords=e),options:o(w).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),Ce,s("div",xe,[B(o(F),{modelValue:o(i).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(i).tribes=e),options:o(w).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),Ve,s("div",Se,[T(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(i).cardText=e)},null,512),[[O,o(i).cardText]])]),Te,s("div",Ne,[B(o(F),{modelValue:o(i).sets,"onUpdate:modelValue":t[6]||(t[6]=e=>o(i).sets=e),options:o(w).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),s("div",Ue,[s("div",Le,[(p(!0),_(U,null,L(o(V).value,e=>(p(),_("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),_("img",{key:0,src:e.image_uris.normal},null,8,Be)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Fe)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Pe)):x("",!0),s("p",Ee,b(e.name),1),s("p",null,b(e.set_name)+" ["+b(e.set)+"]",1),s("p",null,b(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var Re=oe(Oe,[["__scopeId","data-v-17ad836f"]]);const je={setup(m){return(h,y)=>(p(),ee(Re))}};let De=te(je);De.mount("#app");
