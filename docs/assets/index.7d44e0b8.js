import{r as M,a as T,D as $,w as z,o as p,c as _,b as s,u as o,d as b,t as w,n as H,F as L,e as N,f as C,v as E,g as B,k as D,p as J,h as Q,i as X,P as Y,j as P,l as R,m as Z,q as ee}from"./vendor.3899a889.js";const te=function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const k of d.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&n(k)}).observe(document,{childList:!0,subtree:!0});function h(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerpolicy&&(d.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?d.credentials="include":r.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(r){if(r.ep)return;r.ep=!0;const d=h(r);fetch(r.href,d)}};te();var se=(y,m)=>{const h=y.__vccOpts||y;for(const[n,r]of m)h[n]=r;return h};const f=y=>(J("data-v-1b318e07"),y=y(),Q(),y),oe={id:"window"},re={id:"sidebar"},ae={key:0,for:"upload"},le={key:1,class:"progress"},ne=f(()=>s("br",null,null,-1)),ie=f(()=>s("h3",null,"Colours",-1)),ce={class:"filter-group colours"},ue=["data-colour"],de=["value","id"],pe=["for"],_e=f(()=>s("h3",null,"Rarity",-1)),ye={class:"filter-group rarities"},me=["data-rarity"],he=["onUpdate:modelValue","value","id"],fe=["for"],ge={class:"filter-group"},ve=f(()=>s("h3",null,"Name",-1)),we={class:"filter-group"},ke=f(()=>s("h3",null,"Keywords",-1)),be={class:"filter-group"},Ce=f(()=>s("h3",null,"Types",-1)),xe={class:"filter-group"},Se=f(()=>s("h3",null,"Card text",-1)),Ve={class:"filter-group"},Te=f(()=>s("h3",null,"Set",-1)),Ue={id:"main"},Le={class:"cards"},Ne=["src"],Ee=["src"],Fe=["src"],Be={class:"name"},De={props:{},setup(y){const m="https://api.scryfall.com/cards/collection",h=M(null);let n=T({active:!1,progress:0,count:0,total:0});const r=new $("mtg");r.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const d={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},k=["mythic","rare","uncommon","common"];let x=T({tribes:[],keywords:[],sets:[]}),i=T({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",set:""});const U=async(l,t)=>new Promise((e,u)=>{let a=l;if(a.sort((c,g)=>c.prices.eur?parseFloat(c.prices.eur)<parseFloat(g.prices.eur):!0),t.cardText&&t.cardText!=""){const c=new X(a,{ignoreLocation:!0,threshold:.5,keys:["oracle_text","card_faces.oracle_text"]});a=[],c.search(t.cardText).forEach(g=>{a.push(g.item)})}a=a.filter(c=>{const g=!t.name||!t.name!=""||c.name.toLowerCase().includes(t.name.toLowerCase()),I=t.colours.every(v=>v=="C"?c.color_identity.length==0:(c.color_identity||[]).includes(v)),q=t.keywords.every(v=>(c.keywords||[]).includes(v)),K=t.tribes.every(v=>(c.type_line.toLowerCase()||"").includes(v.toLowerCase())),W=t.rarity.length>0?[...t.rarity].includes(c.rarity):!0,G=t.set?c.set==t.set:!0;return I&&q&&K&&W&&g&&G}),e(a.slice(0,200))});let S=[],V=T({value:[]});r.cards.toArray().then(async l=>{S=l,V.value=await U(S,i)});let F=null;z(i,async l=>{clearTimeout(F),F=setTimeout(async()=>{V.value=await U(S,l)},500)}),caches.open("cardDataCache").then(async l=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await l.match(t);e||(await l.add(t),e=await l.match(t));const u=await e.json();console.log(u.data),x.tribes=u.data}),r.cards.orderBy("keywords").uniqueKeys(l=>{let t=new Set;l.forEach(e=>{e.forEach(u=>{t.add(u)})}),x.keywords=[...t]});async function O(l="",t={}){return(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const j=async()=>{const l=new FileReader;n.active=!0,n.progress=0,l.onload=t=>{let e=l.result.replace('"sep=,"',"");Y.parse(e,{header:!0,worker:!0,skipEmptyLines:!0,complete:A})},console.log(Document.characterSet),l.readAsText(h.value.files[0],"UTF-16LE")},A=async l=>{let t=new Set,e=[];l.data.forEach(a=>{let c=a["Set Code"]+a["Card Number"].toString();t.has(c)||e.push({set:a["Set Code"],collector_number:a["Card Number"].toString()}),t.add(c)});let u=[];n.total=e.length;for(let a=0;a<e.length;a+=75){let c=await O(m,{identifiers:e.slice(a,a+75)});u=u.concat(c.data),n.count=a,n.progress=a/e.length*100,await new Promise(g=>setTimeout(g,100))}n.progress=100,await r.cards.clear(),r.cards.bulkAdd(u),S=u,V.value=await U(u,i),n.active=!1,n.progress=0,n.total=0};return(l,t)=>(p(),_("div",oe,[s("div",re,[o(n).active?b("",!0):(p(),_("label",ae,"Upload CSV")),s("input",{id:"upload",ref_key:"file",ref:h,onChange:t[0]||(t[0]=e=>j()),type:"file"},null,544),o(n).active?(p(),_("div",le,[s("span",null,"Processing cards: "+w(o(n).count)+" / "+w(o(n).total),1),s("div",{class:"bar",style:H({width:o(n).progress+"%"})},null,4)])):b("",!0),ne,ie,s("div",ce,[(p(),_(L,null,N(d,(e,u)=>s("div",{class:P(["input-group colour",o(i).colours.includes(e)?"selected":""]),"data-colour":e,key:"code"},[C(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>o(i).colours=a),value:e,id:e},null,8,de),[[R,o(i).colours]]),s("label",{for:e,class:P("icon icon-"+e)},null,10,pe)],10,ue)),64))]),_e,s("div",ye,[(p(),_(L,null,N(k,e=>s("div",{class:"input-group rarity","data-rarity":e,key:"code"},[C(s("input",{type:"checkbox","onUpdate:modelValue":u=>o(i).rarity=u,value:e,id:e},null,8,he),[[R,o(i).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,fe)],8,me)),64))]),s("div",ge,[ve,C(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>o(i).name=e)},null,512),[[E,o(i).name]])]),s("div",we,[ke,B(o(D),{modelValue:o(i).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).keywords=e),options:o(x).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),s("div",be,[Ce,B(o(D),{modelValue:o(i).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(i).tribes=e),options:o(x).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),s("div",xe,[Se,C(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(i).cardText=e)},null,512),[[E,o(i).cardText]])]),s("div",Ve,[Te,C(s("input",{type:"search","onUpdate:modelValue":t[6]||(t[6]=e=>o(i).set=e)},null,512),[[E,o(i).set]])])]),s("div",Ue,[s("div",Le,[(p(!0),_(L,null,N(o(V).value,e=>(p(),_("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),_("img",{key:0,src:e.image_uris.normal},null,8,Ne)):b("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Ee)):b("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Fe)):b("",!0),s("p",Be,w(e.name),1),s("p",null,w(e.set_name)+" ["+w(e.set)+"]",1),s("p",null,w(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var Pe=se(De,[["__scopeId","data-v-1b318e07"]]);const Re={setup(y){return(m,h)=>(p(),Z(Pe))}};let Oe=ee(Re);Oe.mount("#app");
