import{r as M,a as S,D as $,w as z,o as p,c as _,b as s,u as o,d as x,t as b,n as H,F as U,e as L,f as T,v as D,g as F,k as E,p as J,h as Q,i as X,P as Y,j as O,l as R,m as Z,q as ee}from"./vendor.3899a889.js";const te=function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const k of d.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&l(k)}).observe(document,{childList:!0,subtree:!0});function h(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(a){if(a.ep)return;a.ep=!0;const d=h(a);fetch(a.href,d)}};te();var se=(m,y)=>{const h=m.__vccOpts||m;for(const[l,a]of y)h[l]=a;return h};const g=m=>(J("data-v-bb92d5ae"),m=m(),Q(),m),oe={id:"window"},re={id:"sidebar"},ae={key:0,for:"upload"},le={key:1,class:"progress"},ne=g(()=>s("br",null,null,-1)),ie=g(()=>s("h3",null,"Colours",-1)),ce={class:"filter-group colours"},ue=["data-colour"],de=["value","id"],pe=["for"],_e=g(()=>s("h3",null,"Rarity",-1)),me={class:"filter-group rarities"},ye=["data-rarity"],he=["onUpdate:modelValue","value","id"],fe=["for"],ge=g(()=>s("h3",null,"Name",-1)),ve={class:"filter-group"},we=g(()=>s("h3",null,"Keywords",-1)),be={class:"filter-group"},ke=g(()=>s("h3",null,"Types",-1)),Ce={class:"filter-group"},xe=g(()=>s("h3",null,"Card text",-1)),Ve={class:"filter-group"},Se=g(()=>s("h3",null,"Set",-1)),Te={class:"filter-group"},Ne={id:"main"},Ue={class:"cards"},Le=["src"],Fe=["src"],Ee=["src"],Pe={class:"name"},Be={props:{},setup(m){const y="https://api.scryfall.com/cards/collection",h=M(null);let l=S({active:!1,progress:0,count:0,total:0});const a=new $("mtg");a.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const d={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},k=["mythic","rare","uncommon","common"];let w=S({tribes:[],keywords:[],sets:[]}),n=S({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[]});const N=async(i,t)=>new Promise((e,c)=>{let r=i;if(r.sort((u,v)=>u.prices.eur?parseFloat(u.prices.eur)<parseFloat(v.prices.eur):!0),t.cardText&&t.cardText!=""){const u=new X(r,{ignoreLocation:!0,threshold:.5,keys:["oracle_text","card_faces.oracle_text"]});r=[],u.search(t.cardText).forEach(v=>{r.push(v.item)})}r=r.filter(u=>{const v=!t.name||!t.name!=""||u.name.toLowerCase().includes(t.name.toLowerCase()),q=t.colours.every(f=>f=="C"?u.color_identity.length==0:(u.color_identity||[]).includes(f)),W=t.keywords.every(f=>(u.keywords||[]).includes(f)),G=t.tribes.every(f=>(u.type_line.toLowerCase()||"").includes(f.toLowerCase())),K=t.rarity.length>0?[...t.rarity].includes(u.rarity):!0;let B=!0;return t.sets.length>0&&(B=t.sets.some(f=>u.set==f)),q&&W&&G&&K&&v&&B}),e(r.slice(0,200))});let C=[],V=S({value:[]});a.cards.toArray().then(async i=>{C=i,V.value=await N(C,n);let t=new Set,e=[];C.forEach(c=>{c.keywords.forEach(r=>{t.add(r)}),e[c.set]=c.set_name}),w.keywords=[...t],w.sets=Object.keys(e).map(c=>({set:c,setName:e[c]}))});let P=null;z(n,async i=>{clearTimeout(P),P=setTimeout(async()=>{V.value=await N(C,i)},500)}),caches.open("cardDataCache").then(async i=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await i.match(t);e||(await i.add(t),e=await i.match(t));const c=await e.json();w.tribes=c.data});async function j(i="",t={}){return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const A=async()=>{const i=new FileReader;l.active=!0,l.progress=0,i.onload=t=>{let e=i.result.replace('"sep=,"',"");Y.parse(e,{header:!0,worker:!0,skipEmptyLines:!0,complete:I})},console.log(Document.characterSet),i.readAsText(h.value.files[0],"UTF-16LE")},I=async i=>{let t=new Set,e=[];i.data.forEach(r=>{let u=r["Set Code"]+r["Card Number"].toString();t.has(u)||e.push({set:r["Set Code"],collector_number:r["Card Number"].toString()}),t.add(u)});let c=[];l.total=e.length;for(let r=0;r<e.length;r+=75){let u=await j(y,{identifiers:e.slice(r,r+75)});c=c.concat(u.data),l.count=r,l.progress=r/e.length*100,await new Promise(v=>setTimeout(v,100))}l.progress=100,await a.cards.clear(),a.cards.bulkAdd(c),C=c,V.value=await N(c,n),l.active=!1,l.progress=0,l.total=0};return(i,t)=>(p(),_("div",oe,[s("div",re,[o(l).active?x("",!0):(p(),_("label",ae,"Upload CSV")),s("input",{id:"upload",ref_key:"file",ref:h,onChange:t[0]||(t[0]=e=>A()),type:"file"},null,544),o(l).active?(p(),_("div",le,[s("span",null,"Processing cards: "+b(o(l).count)+" / "+b(o(l).total),1),s("div",{class:"bar",style:H({width:o(l).progress+"%"})},null,4)])):x("",!0),ne,ie,s("div",ce,[(p(),_(U,null,L(d,(e,c)=>s("div",{class:O(["input-group colour",o(n).colours.includes(e)?"selected":""]),"data-colour":e,key:"code"},[T(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=r=>o(n).colours=r),value:e,id:e},null,8,de),[[R,o(n).colours]]),s("label",{for:e,class:O("icon icon-"+e)},null,10,pe)],10,ue)),64))]),_e,s("div",me,[(p(),_(U,null,L(k,e=>s("div",{class:"input-group rarity","data-rarity":e,key:"code"},[T(s("input",{type:"checkbox","onUpdate:modelValue":c=>o(n).rarity=c,value:e,id:e},null,8,he),[[R,o(n).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,fe)],8,ye)),64))]),ge,s("div",ve,[T(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>o(n).name=e)},null,512),[[D,o(n).name]])]),we,s("div",be,[F(o(E),{modelValue:o(n).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(n).keywords=e),options:o(w).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),ke,s("div",Ce,[F(o(E),{modelValue:o(n).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(n).tribes=e),options:o(w).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),xe,s("div",Ve,[T(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(n).cardText=e)},null,512),[[D,o(n).cardText]])]),Se,s("div",Te,[F(o(E),{modelValue:o(n).sets,"onUpdate:modelValue":t[6]||(t[6]=e=>o(n).sets=e),options:o(w).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),s("div",Ne,[s("div",Ue,[(p(!0),_(U,null,L(o(V).value,e=>(p(),_("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),_("img",{key:0,src:e.image_uris.normal},null,8,Le)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Fe)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Ee)):x("",!0),s("p",Pe,b(e.name),1),s("p",null,b(e.set_name)+" ["+b(e.set)+"]",1),s("p",null,b(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var De=se(Be,[["__scopeId","data-v-bb92d5ae"]]);const Oe={setup(m){return(y,h)=>(p(),Z(De))}};let Re=ee(Oe);Re.mount("#app");
