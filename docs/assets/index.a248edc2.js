import{r as C,D as K,w as W,o as p,c as f,a as s,u as o,b,t as k,n as q,F as V,d as U,e as w,v as S,f as N,k as L,p as G,g as z,P as H,h as A,i as O,j as $,l as J,m as Q}from"./vendor.8decfd25.js";const X=function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))y(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&y(m)}).observe(document,{childList:!0,subtree:!0});function l(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerpolicy&&(u.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?u.credentials="include":c.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function y(c){if(c.ep)return;c.ep=!0;const u=l(c);fetch(c.href,u)}};X();var Y=(_,g)=>{const l=_.__vccOpts||_;for(const[y,c]of g)l[y]=c;return l};const h=_=>(G("data-v-7aaee827"),_=_(),z(),_),Z={id:"window"},ee={id:"sidebar"},te={key:0,for:"upload"},se={key:1,class:"progress"},oe=h(()=>s("br",null,null,-1)),ae=h(()=>s("h3",null,"Colours",-1)),re={class:"filter-group colours"},ne=["data-colour"],le=["value","id"],ie=["for"],ce=h(()=>s("h3",null,"Rarity",-1)),ue={class:"filter-group rarities"},de=["data-rarity"],pe=["onUpdate:modelValue","value","id"],me=["for"],fe=h(()=>s("h3",null,"Name",-1)),_e={class:"filter-group"},ye=h(()=>s("h3",null,"Mana Cost",-1)),he={class:"filter-group mana"},ge=h(()=>s("h3",null,"Keywords",-1)),ve={class:"filter-group"},we=h(()=>s("h3",null,"Types",-1)),be={class:"filter-group"},ke=h(()=>s("h3",null,"Card text",-1)),xe={class:"filter-group"},Ce=h(()=>s("h3",null,"Set",-1)),Se={class:"filter-group"},Te={id:"main"},Ve={class:"cards"},Ue=["src"],Ne=["src"],Le=["src"],Fe={class:"name"},Ee={setup(_){const g="https://api.scryfall.com/cards/collection",l=C({active:!1,progress:0,count:0,total:0}),y=new K("mtg");y.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const c={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},u=["mythic","rare","uncommon","common"],m=C({tribes:[],keywords:[],sets:[]}),n=C({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:{min:0,max:20}}),F=async(i,t)=>new Promise(e=>{let r=i;if(r.sort((a,d)=>a.prices.eur?parseFloat(a.prices.eur)<parseFloat(d.prices.eur):!0),t.cardText&&t.cardText!==""){const a=new $(r,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});r=[],a.search(t.cardText).forEach(d=>{r.push(d.item)})}r=r.filter(a=>{if(!(!t.name||!t.name!==""||a.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(v=>v==="C"?a.color_identity.length===0:(a.color_identity||[]).includes(v))||!t.keywords.every(v=>(a.keywords||[]).includes(v))||!t.tribes.every(v=>(a.type_line.toLowerCase()||"").includes(v.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(a.rarity):!0))return!1;let R=!0;return t.sets.length>0&&(R=t.sets.some(v=>a.set===v)),!(!R||!(a.cmc>=(t.mana.min||0)&&a.cmc<=(t.mana.max!==""?t.mana.max:20)))}),e(r.slice(0,200))});let x=[];const T=C({value:[]}),E=async i=>{x=i,T.value=await F(x,n);const t=new Set,e=[];x.forEach(r=>{r.keywords.forEach(a=>{t.add(a)}),e[r.set]=r.set_name}),m.keywords=[...t],m.sets=Object.keys(e).map(r=>({set:r,setName:e[r]}))};y.cards.toArray().then(i=>E(i));let B=null;W(n,async i=>{clearTimeout(B),B=setTimeout(async()=>{T.value=await F(x,i)},500)}),caches.open("cardDataCache").then(async i=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await i.match(t);e||(await i.add(t),e=await i.match(t));const r=await e.json();m.tribes=r.data});async function D(i="",t={}){return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const M=async i=>{let t=await i.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},j=async i=>{let t=i.target.files[0];const e=new FileReader;l.active=!0,l.progress=0,e.onload=a=>{const d=e.result.replace('"sep=,"',"");H.parse(d,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:I})};let r=await M(t);console.log(r),e.readAsText(t,r)},I=async i=>{const t=new Set,e=[];i.data.forEach(a=>{const d=a["Set Code"]+a["Card Number"].toString();t.has(d)||e.push({set:a["Set Code"],collector_number:a["Card Number"].toString()}),t.add(d)});let r=[];l.total=e.length;for(let a=0;a<e.length;a+=75){const d=await D(g,{identifiers:e.slice(a,a+75)});r=r.concat(d.data),l.count=a,l.progress=a/e.length*100,await new Promise(P=>setTimeout(P,100))}l.progress=100,await y.cards.clear(),y.cards.bulkAdd(r),E(r),l.active=!1,l.progress=0,l.total=0};return(i,t)=>(p(),f("div",Z,[s("div",ee,[o(l).active?b("",!0):(p(),f("label",te,"Upload CSV")),s("input",{id:"upload",ref:"file",onChange:j,type:"file"},null,544),o(l).active?(p(),f("div",se,[s("span",null,"Processing cards: "+k(o(l).count)+" / "+k(o(l).total),1),s("div",{class:"bar",style:q({width:o(l).progress+"%"})},null,4)])):b("",!0),oe,ae,s("div",re,[(p(),f(V,null,U(c,e=>s("div",{class:A(["input-group colour",o(n).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[w(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=r=>o(n).colours=r),value:e,id:e},null,8,le),[[O,o(n).colours]]),s("label",{for:e,class:A("icon icon-"+e)},null,10,ie)],10,ne)),64))]),ce,s("div",ue,[(p(),f(V,null,U(u,e=>s("div",{class:"input-group rarity","data-rarity":e,key:e},[w(s("input",{type:"checkbox","onUpdate:modelValue":r=>o(n).rarity=r,value:e,id:e},null,8,pe),[[O,o(n).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,me)],8,de)),64))]),fe,s("div",_e,[w(s("input",{type:"search","onUpdate:modelValue":t[1]||(t[1]=e=>o(n).name=e)},null,512),[[S,o(n).name]])]),ye,s("div",he,[w(s("input",{id:"mana-min",type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>o(n).mana.min=e)},null,512),[[S,o(n).mana.min]]),w(s("input",{id:"mana-max",type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>o(n).mana.max=e)},null,512),[[S,o(n).mana.max]])]),ge,s("div",ve,[N(o(L),{modelValue:o(n).keywords,"onUpdate:modelValue":t[4]||(t[4]=e=>o(n).keywords=e),options:o(m).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),we,s("div",be,[N(o(L),{modelValue:o(n).tribes,"onUpdate:modelValue":t[5]||(t[5]=e=>o(n).tribes=e),options:o(m).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),ke,s("div",xe,[w(s("input",{type:"search","onUpdate:modelValue":t[6]||(t[6]=e=>o(n).cardText=e)},null,512),[[S,o(n).cardText]])]),Ce,s("div",Se,[N(o(L),{modelValue:o(n).sets,"onUpdate:modelValue":t[7]||(t[7]=e=>o(n).sets=e),options:o(m).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),s("div",Te,[s("div",Ve,[(p(!0),f(V,null,U(o(T).value,e=>(p(),f("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),f("img",{key:0,src:e.image_uris.normal},null,8,Ue)):b("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),f("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Ne)):b("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),f("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Le)):b("",!0),s("p",Fe,k(e.name),1),s("p",null,k(e.set_name),1),s("p",null,k(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var Be=Y(Ee,[["__scopeId","data-v-7aaee827"]]);const Pe={setup(_){return(g,l)=>(p(),J(Be))}},Re=Q(Pe);Re.mount("#app");
