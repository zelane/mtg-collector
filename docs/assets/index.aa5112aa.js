import{r as L,D as de,a as J,w as X,P as j,o as u,c as d,b as s,d as V,u as o,k as M,F,e as P,f as N,v as A,g as Y,h as g,t as k,n as Z,i as I,p as me,j as pe,l as G,m as fe,q as he,s as _e}from"./vendor.c0f5632a.js";const ye=function(){const T=document.createElement("link").relList;if(T&&T.supports&&T.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))v(m);new MutationObserver(m=>{for(const y of m)if(y.type==="childList")for(const _ of y.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&v(_)}).observe(document,{childList:!0,subtree:!0});function n(m){const y={};return m.integrity&&(y.integrity=m.integrity),m.referrerpolicy&&(y.referrerPolicy=m.referrerpolicy),m.crossorigin==="use-credentials"?y.credentials="include":m.crossorigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function v(m){if(m.ep)return;m.ep=!0;const y=n(m);fetch(m.href,y)}};ye();var ve=(x,T)=>{const n=x.__vccOpts||x;for(const[v,m]of T)n[v]=m;return n};const f=x=>(me("data-v-5bf72422"),x=x(),pe(),x),ge={id:"window"},be={id:"sidebar"},Ce={class:"filter-group collections"},we=f(()=>s("h3",null,"View Collection",-1)),ke={class:"filter-group"},xe=f(()=>s("h3",null,"View Set",-1)),Ve=f(()=>s("hr",null,null,-1)),Te={class:"filter-group colours"},Se=f(()=>s("h3",null,"Colours",-1)),Ue=["data-colour"],Ne=["value","id"],Ee=["for"],Le={class:"filter-group rarities"},Me=f(()=>s("h3",null,"Rarity",-1)),Fe=["data-rarity"],Oe=["onUpdate:modelValue","value","id"],Pe=["for","title"],$e={class:"filter-group"},De=f(()=>s("h3",null,"Name",-1)),Ae={class:"filter-group mana"},Ge=f(()=>s("h3",null,"Mana Cost",-1)),Be={class:"filter-group"},je=f(()=>s("h3",null,"Types",-1)),Ie={class:"filter-group"},Re=f(()=>s("h3",null,"Keywords",-1)),We={class:"filter-group"},ze=f(()=>s("h3",null,"Card text",-1)),qe={class:"filter-group"},Ke=f(()=>s("h3",null,"Set",-1)),He={key:0,class:"filter-group compare"},Qe=f(()=>s("h3",null,"Compare",-1)),Je={class:"grid"},Xe=["id","onUpdate:modelValue"],Ye=["for"],Ze=["id","onUpdate:modelValue"],et=["for"],tt={id:"main"},ot={key:0,class:"loader"},st={key:1,class:"upload"},lt=f(()=>s("span",null,"+",-1)),nt=[lt],at={class:"form"},rt=f(()=>s("h3",null,"Name",-1)),it=f(()=>s("h3",null,"Format",-1)),ct={key:1,class:"button",for:"file-input"},ut=["disabled"],dt={key:3,class:"buttons"},mt={key:4,class:"progress"},pt={class:"info-bar"},ft=f(()=>s("div",{class:"menu"},null,-1)),ht=f(()=>s("h3",null,"Clipboard",-1)),_t={class:"clip-cards"},yt={class:"buttons"},vt={class:"img"},gt=["src"],bt=["src"],Ct=["src"],wt=["onClick"],kt={class:"name"},xt={setup(x){const T="https://api.scryfall.com/cards/collection",n=L({show:!1,name:null,file:null,text:null,encoding:null,format:null,active:!1,progress:0,count:0,total:0}),v=new de("mtg");v.version(1).stores({collections:"&name"});const m={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},y=["special","mythic","rare","uncommon","common"],_=L({tribes:[],keywords:[],sets:[],allSets:[]}),c=L({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20],dupesOnly:!1,sort:"Price",incCol:{},excCol:{}}),ee=["Mana","Price","Count"],b=L({count:0,total_value:0,zoom:0}),S=L({show:!1,cards:[]}),R=new Set;let O=J(!1);const te=(l,t)=>{if(c.sort==="Price")return l.price?l.price<t.price?1:-1:!0;if(c.sort==="Mana")return parseFloat(l.cmc)<parseFloat(t.cmc)?1:-1;if(c.sort==="Count")return parseFloat(l.count)<parseFloat(t.count)?1:-1},W=async(l,t)=>new Promise(async e=>{let a=setTimeout(()=>O.value=!0,300),r=l.sort(te);if(t.cardText&&t.cardText!==""){const i=new fe(r,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});r=[],i.search(t.cardText).forEach(p=>{r.push(p.item)})}for(const i of Object.keys(t.incCol)){if(!t.incCol[i])continue;const C=(await v.collections.get({name:i})).cards.map(h=>h.oracle_id);r=r.filter(h=>C.includes(h.oracle_id))}for(const i of Object.keys(t.excCol)){if(!t.excCol[i])continue;const C=(await v.collections.get({name:i})).cards.map(h=>h.oracle_id);r=r.filter(h=>!C.includes(h.oracle_id))}b.count=0,b.total_value=0,r=r.filter(i=>{if(t.dupesOnly&&i.count===1||!(!t.name||!t.name!=""||i.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(U=>U==="C"?i.color_identity.length===0:(i.color_identity||[]).includes(U))||!t.keywords.every(U=>(i.keywords||[]).includes(U))||!t.tribes.every(U=>(i.type_line.toLowerCase()||"").includes(U.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(i.rarity):!0))return!1;let Q=!0;return t.sets.length>0&&(Q=t.sets.some(U=>i.set===U)),!Q||!(i.cmc>=t.mana[0]&&i.cmc<=t.mana[1])?!1:(b.total_value+=i.price,!0)}),b.total_value=parseInt(b.total_value),b.count=r.length,clearTimeout(a),O.value=!1,e(r.slice(0,250))});let $=[];const w=L({collections:[],value:[]});let E=L({value:""});const oe=async l=>{if(l==="")return;let t=await v.collections.get({name:l});z(t.cards)},se=async l=>{let t="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:"e:"+l,unique:"prints"}),e=[];O.value=!0;try{for(;;){let a=await B(K,t);if(e=e.concat(a.data),!a.has_more)break;t=a.next_page,await new Promise(r=>setTimeout(r,100))}z(e)}finally{O.value=!1}},z=async l=>{$=l;const t=new Set,e=[];let a=.9;$.forEach(r=>{r.price=parseFloat(r.prices.eur||parseFloat(r.prices.usd)*a||0),r.keywords.forEach(i=>{t.add(i)}),e[r.set]=r.set_name}),_.keywords=[...t],_.sets=Object.keys(e).map(r=>({set:r,setName:e[r]})),w.value=await W($,c)},le=async l=>{await v.collections.delete(l),w.collections.pop(l),E.value=""};X(E,l=>oe(l.value));let q=null;X(c,async l=>{clearTimeout(q),q=setTimeout(async()=>{w.value=await W($,l)},500)}),v.collections.toCollection().primaryKeys().then(l=>{l.length!==0&&(w.collections=l.sort(),E.value=l[0])});const B=async(l,t)=>{const e=new Request(t);let a=await l.match(e);return a||(await l.add(e),a=await l.match(e)),await a.json()};let K=null;caches.open("cardDataCache").then(async l=>{K=l;let t=await B(l,"https://api.scryfall.com/catalog/creature-types");_.tribes=t.data,_.tribes=_.tribes.concat(["Enchantment","Sorcery","Land","Creature","Instant","Artifact"]);let e=await B(l,"https://api.scryfall.com/sets");e.data.forEach(a=>R.add(a.code)),_.allSets=e.data});const ne=async(l="",t={})=>(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),ae=async l=>{let t=await l.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},re=async l=>{n.active=!0,n.progress=0;let t={};if(n.format==="MTGA"){const e=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,a=n.text.matchAll(e);for(const r of a)t[r[3]+r[4]]={name:r[2],count:r[1],set:r[3],number:r[4]}}else if(n.format==="MTGO"){const e=/([0-9]+) (.+)/g,a=n.text.matchAll(e);for(const r of a)t[r[2]]={name:r[2],count:r[1],set:"",number:""}}H(t)},D=J(null),ie=async l=>{if(D.value.files.length===0)return;let t=D.value.files[0];const e=new FileReader;n.active=!0,n.progress=0;let a=null;n.format==="DragonShield Web"&&(a=ce),e.onload=async()=>{let i=await a(e.result);H(i)};let r=await ae(t);e.readAsText(t,r)};j.parsePromise=l=>new Promise((t,e)=>{j.parse(l,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:t,error:e})});const ce=async l=>{l=l.replace('"sep=,"',"");let t=await j.parsePromise(l),e={};return t.data.forEach(a=>{const r=a["Set Name"];let i=a["Set Code"].toLowerCase();R.has(i)?e[i+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:i,number:a["Card Number"].toString()}:(console.log(`Couldn't find set for ${a["Card Name"]} ${a["Card Number"]} ${r} [${i}]`),e[i+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:"",number:""})}),e},H=async l=>{const t=[],e={};try{Object.keys(l).forEach(i=>{let p=l[i],C={};p.set===""&&p.number===""?(C.name=p.name,e[p.name]=p.count):(C.set=p.set,C.collector_number=p.number,e[p.set+p.number]=p.count),t.push(C)});let a=[];n.total=t.length;for(let i=0;i<t.length;i+=75){const p=await ne(T,{identifiers:t.slice(i,i+75)});p.not_found.length>0&&console.log(p.not_found);let C=p.data.map(h=>(h.count=e[h.name]||e[h.set+h.collector_number],h));a=a.concat(C),n.count=i,n.progress=i/t.length*100,await new Promise(h=>setTimeout(h,100))}n.progress=100;let r=n.name;v.collections.put({name:r,cards:a}),w.collections.includes(r)||w.collections.push(r),E.value=r}catch{}finally{n.active=!1,n.count=0,n.progress=0,n.total=0,n.show=!1}},ue=async l=>{console.log(S.cards);let t=`"Count","Tradelist Count","Name","Edition","Condition","Language","Foil","Tags","Last Modified","Collector Number"
`;S.cards.forEach(e=>{console.log(e.name),t+=`"${e.count}","0","${e.name}","${e.set}","Near Mint","English","","","2022-03-22 02:52:33.210000","${e.collector_number}"
`}),navigator.clipboard.writeText(t)};return(l,t)=>(u(),d("div",ge,[s("div",be,[s("div",Ce,[we,V(o(M),{modelValue:o(E).value,"onUpdate:modelValue":t[0]||(t[0]=e=>o(E).value=e),options:o(w).collections,mode:"single","can-clear":!1},null,8,["modelValue","options"]),s("button",{class:"small add",onClick:t[1]||(t[1]=e=>o(n).show=!0)}," + "),s("button",{class:"small remove",onClick:t[2]||(t[2]=e=>le(o(E).value))}," - ")]),s("div",ke,[xe,V(o(M),{options:o(_).allSets,label:"name","value-prop":"code",searchable:!0,mode:"single",onSelect:se},null,8,["options"])]),Ve,s("div",Te,[Se,(u(),d(F,null,P(m,e=>s("div",{class:I(["input-group colour",o(c).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[N(s("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=a=>o(c).colours=a),value:e,id:e},null,8,Ne),[[G,o(c).colours]]),s("label",{for:e,class:I("icon icon-"+e)},null,10,Ee)],10,Ue)),64))]),s("div",Le,[Me,(u(),d(F,null,P(y,e=>s("div",{class:"input-group rarity","data-rarity":e,key:e},[N(s("input",{type:"checkbox","onUpdate:modelValue":a=>o(c).rarity=a,value:e,id:e},null,8,Oe),[[G,o(c).rarity]]),s("label",{for:e,title:e},null,8,Pe)],8,Fe)),64))]),s("div",$e,[De,N(s("input",{type:"search","onUpdate:modelValue":t[4]||(t[4]=e=>o(c).name=e)},null,512),[[A,o(c).name]])]),s("div",Ae,[Ge,V(o(Y),{modelValue:o(c).mana,"onUpdate:modelValue":t[5]||(t[5]=e=>o(c).mana=e),min:0,max:20},null,8,["modelValue"])]),s("div",Be,[je,V(o(M),{modelValue:o(c).tribes,"onUpdate:modelValue":t[6]||(t[6]=e=>o(c).tribes=e),options:o(_).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),s("div",Ie,[Re,V(o(M),{modelValue:o(c).keywords,"onUpdate:modelValue":t[7]||(t[7]=e=>o(c).keywords=e),options:o(_).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),s("div",We,[ze,N(s("input",{type:"search","onUpdate:modelValue":t[8]||(t[8]=e=>o(c).cardText=e)},null,512),[[A,o(c).cardText]])]),s("div",qe,[Ke,V(o(M),{modelValue:o(c).sets,"onUpdate:modelValue":t[9]||(t[9]=e=>o(c).sets=e),options:o(_).sets,label:"setName","value-prop":"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),o(w).collections.length>0?(u(),d("div",He,[Qe,s("div",Je,[(u(!0),d(F,null,P(o(w).collections,e=>(u(),d(F,{key:e},[s("div",null,k(e),1),s("div",null,[N(s("input",{type:"checkbox",id:e+"-inc","onUpdate:modelValue":a=>o(c).incCol[e]=a,value:!1},null,8,Xe),[[G,o(c).incCol[e]]]),s("label",{class:"inc",for:e+"-inc"},null,8,Ye)]),s("div",null,[N(s("input",{type:"checkbox",id:e+"-exc","onUpdate:modelValue":a=>o(c).excCol[e]=a,value:!1},null,8,Ze),[[G,o(c).excCol[e]]]),s("label",{class:"exc",for:e+"-exc"},null,8,et)])],64))),128))])])):g("",!0)]),s("div",tt,[o(O)?(u(),d("div",ot," Loading ")):g("",!0),o(n).show?(u(),d("div",st,[s("button",{class:"small close",onClick:t[10]||(t[10]=e=>o(n).show=!1)},nt),s("div",at,[rt,N(s("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>o(n).name=e)},null,512),[[A,o(n).name]]),it,V(o(M),{modelValue:o(n).format,"onUpdate:modelValue":t[12]||(t[12]=e=>o(n).format=e),options:["DragonShield Web","DragonShield Mobile","MTGA","MTGO"],"can-clear":!1},null,8,["modelValue"]),["MTGA","MTGO"].includes(o(n).format)?N((u(),d("textarea",{key:0,"onUpdate:modelValue":t[13]||(t[13]=e=>o(n).text=e)},null,512)),[[A,o(n).text]]):g("",!0),["DragonShield Web","DragonShield Mobile"].includes(o(n).format)?(u(),d("label",ct,"Choose file")):g("",!0),o(n).format==="DragonShield Web"?(u(),d("input",{key:2,id:"file-input",ref_key:"fileElem",ref:D,type:"file",disabled:o(n).active},null,8,ut)):g("",!0),!o(n).active&&o(n).format&&(o(n).text||D.value)?(u(),d("div",dt,[s("button",{onClick:t[14]||(t[14]=e=>["MTGA","MTGO"].includes(o(n).format)?re():ie())}," Upload ")])):g("",!0),o(n).active?(u(),d("div",mt,[s("span",null,"Processing cards: "+k(o(n).count)+" / "+k(o(n).total),1),s("div",{class:"bar",style:Z({width:o(n).progress+"%"})},null,4)])):g("",!0)])])):g("",!0),s("div",pt,[s("span",null,"Count: "+k(o(b).count),1),s("span",null,"Total Value: "+k(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(o(b).total_value)),1),s("span",null,[V(o(M),{modelValue:o(c).sort,"onUpdate:modelValue":t[15]||(t[15]=e=>o(c).sort=e),options:ee,mode:"single","can-clear":!1},null,8,["modelValue"])]),s("span",null,[V(o(Y),{min:-5,max:5,modelValue:o(b).zoom,"onUpdate:modelValue":t[16]||(t[16]=e=>o(b).zoom=e)},null,8,["modelValue"])])]),ft,s("div",{class:I(["clipboard",{show:o(S).show}]),onClick:t[18]||(t[18]=e=>o(S).show=!o(S).show)},[ht,s("div",_t,[(u(!0),d(F,null,P(o(S).cards,e=>(u(),d("div",{class:"clip-card",key:"clip-"+e.name},[s("p",null,"1 "+k(e.name),1)]))),128))]),s("div",yt,[s("button",{onClick:t[17]||(t[17]=e=>o(S).cards=[])},"Clear"),s("button",{onClick:ue},"Copy")])],2),o(n).show?g("",!0):(u(),d("div",{key:2,class:"cards",style:Z({"font-size":18+o(b).zoom*2+"px"})},[(u(!0),d(F,null,P(o(w).value,e=>(u(),d("div",{class:"card",key:e.id+e.foil},[s("div",vt,[e.image_uris?(u(),d("img",{key:0,src:e.image_uris.normal},null,8,gt)):g("",!0),e.card_faces&&e.card_faces[0].image_uris?(u(),d("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,bt)):g("",!0),e.card_faces&&e.card_faces[0].image_uris?(u(),d("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Ct)):g("",!0),s("button",{class:"small clip",onClick:a=>o(S).cards.push(e)},"+",8,wt)]),s("p",kt,k(e.count)+" "+k(e.name),1),s("p",null,k(e.set_name),1),s("p",null,k(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.price)),1)]))),128))],4))])]))}};var Vt=ve(xt,[["__scopeId","data-v-5bf72422"]]);const Tt={setup(x){return(T,n)=>(u(),he(Vt))}},St=_e(Tt);St.mount("#app");
