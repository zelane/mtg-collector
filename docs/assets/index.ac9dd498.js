import{r as C,D as q,w as K,o as p,c as m,a as s,u as o,b as w,t as b,n as W,F as T,d as U,e as x,v as R,f as V,P as G,k as N,p as z,g as H,h as $,i as A,j as O,l as J,m as Q,q as X}from"./vendor.08472bc0.js";const Y=function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))y(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const _ of u.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&y(_)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerpolicy&&(u.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?u.credentials="include":i.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function y(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}};Y();var Z=(f,g)=>{const n=f.__vccOpts||f;for(const[y,i]of g)n[y]=i;return n};const h=f=>(z("data-v-a0cb9eb6"),f=f(),H(),f),ee={id:"window"},te={id:"sidebar"},se={key:0,for:"upload"},oe={key:1,class:"progress"},ae=h(()=>s("br",null,null,-1)),re=h(()=>s("h3",null,"Colours",-1)),ne={class:"filter-group colours"},le=["data-colour"],ie=["value","id"],ce=["for"],ue=h(()=>s("h3",null,"Rarity",-1)),de={class:"filter-group rarities"},pe=["data-rarity"],_e=["onUpdate:modelValue","value","id"],me=["for"],fe=h(()=>s("h3",null,"Name",-1)),ye={class:"filter-group"},he=h(()=>s("h3",null,"Mana Cost",-1)),ge={class:"filter-group mana"},ve=h(()=>s("h3",null,"Keywords",-1)),we={class:"filter-group"},be=h(()=>s("h3",null,"Types",-1)),ke={class:"filter-group"},Ce=h(()=>s("h3",null,"Card text",-1)),xe={class:"filter-group"},Ve=h(()=>s("h3",null,"Set",-1)),Se={class:"filter-group"},Te={id:"main"},Ue={class:"cards"},Ne=["src"],Le=["src"],Fe=["src"],Ee={class:"name"},Be={setup(f){const g="https://api.scryfall.com/cards/collection",n=C({active:!1,progress:0,count:0,total:0}),y=new q("mtg");y.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const i={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},u=["mythic","rare","uncommon","common"],_=C({tribes:[],keywords:[],sets:[]}),c=C({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20]}),L=async(l,t)=>new Promise(e=>{let r=l;if(r.sort((a,d)=>a.prices.eur?parseFloat(a.prices.eur)<parseFloat(d.prices.eur):!0),t.cardText&&t.cardText!==""){const a=new J(r,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});r=[],a.search(t.cardText).forEach(d=>{r.push(d.item)})}r=r.filter(a=>{if(!(!t.name||!t.name!=""||a.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(v=>v==="C"?a.color_identity.length===0:(a.color_identity||[]).includes(v))||!t.keywords.every(v=>(a.keywords||[]).includes(v))||!t.tribes.every(v=>(a.type_line.toLowerCase()||"").includes(v.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(a.rarity):!0))return!1;let P=!0;return t.sets.length>0&&(P=t.sets.some(v=>a.set===v)),!(!P||!(a.cmc>=t.mana[0]&&a.cmc<=t.mana[1]))}),e(r.slice(0,200))});let k=[];const S=C({value:[]}),F=async l=>{k=l,S.value=await L(k,c);const t=new Set,e=[];k.forEach(r=>{r.keywords.forEach(a=>{t.add(a)}),e[r.set]=r.set_name}),_.keywords=[...t],_.sets=Object.keys(e).map(r=>({set:r,setName:e[r]}))};y.cards.toArray().then(l=>F(l));let E=null;K(c,async l=>{clearTimeout(E),E=setTimeout(async()=>{S.value=await L(k,l)},500)}),caches.open("cardDataCache").then(async l=>{const t=new Request("https://api.scryfall.com/catalog/creature-types");let e=await l.match(t);e||(await l.add(t),e=await l.match(t));const r=await e.json();_.tribes=r.data});async function D(l="",t={}){return(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const M=async l=>{let t=await l.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},j=async l=>{let t=l.target.files[0];const e=new FileReader;n.active=!0,n.progress=0,e.onload=a=>{const d=e.result.replace('"sep=,"',"");$.parse(d,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:I})};let r=await M(t);console.log(r),e.readAsText(t,r)},I=async l=>{const t=new Set,e=[];l.data.forEach(a=>{const d=a["Set Code"]+a["Card Number"].toString();t.has(d)||e.push({set:a["Set Code"],collector_number:a["Card Number"].toString()}),t.add(d)});let r=[];n.total=e.length;for(let a=0;a<e.length;a+=75){const d=await D(g,{identifiers:e.slice(a,a+75)});r=r.concat(d.data),n.count=a,n.progress=a/e.length*100,await new Promise(B=>setTimeout(B,100))}n.progress=100,await y.cards.clear(),y.cards.bulkAdd(r),F(r),n.active=!1,n.progress=0,n.total=0};return(l,t)=>(p(),m("div",ee,[s("div",te,[o(n).active?w("",!0):(p(),m("label",se,"Upload CSV")),s("input",{id:"upload",ref:"file",onChange:j,type:"file"},null,544),o(n).active?(p(),m("div",oe,[s("span",null,"Processing cards: "+b(o(n).count)+" / "+b(o(n).total),1),s("div",{class:"bar",style:W({width:o(n).progress+"%"})},null,4)])):w("",!0),ae,re,s("div",ne,[(p(),m(T,null,U(i,e=>s("div",{class:A(["input-group colour",o(c).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[x(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=r=>o(c).colours=r),value:e,id:e},null,8,ie),[[O,o(c).colours]]),s("label",{for:e,class:A("icon icon-"+e)},null,10,ce)],10,le)),64))]),ue,s("div",de,[(p(),m(T,null,U(u,e=>s("div",{class:"input-group rarity","data-rarity":e,key:e},[x(s("input",{type:"checkbox","onUpdate:modelValue":r=>o(c).rarity=r,value:e,id:e},null,8,_e),[[O,o(c).rarity]]),s("label",{for:e,class:"icon icon-logo"},null,8,me)],8,pe)),64))]),fe,s("div",ye,[x(s("input",{type:"search","onUpdate:modelValue":t[1]||(t[1]=e=>o(c).name=e)},null,512),[[R,o(c).name]])]),he,s("div",ge,[V(o(G),{modelValue:o(c).mana,"onUpdate:modelValue":t[2]||(t[2]=e=>o(c).mana=e),min:0,max:20},null,8,["modelValue"])]),ve,s("div",we,[V(o(N),{modelValue:o(c).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(c).keywords=e),options:o(_).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),be,s("div",ke,[V(o(N),{modelValue:o(c).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(c).tribes=e),options:o(_).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),Ce,s("div",xe,[x(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(c).cardText=e)},null,512),[[R,o(c).cardText]])]),Ve,s("div",Se,[V(o(N),{modelValue:o(c).sets,"onUpdate:modelValue":t[6]||(t[6]=e=>o(c).sets=e),options:o(_).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),s("div",Te,[s("div",Ue,[(p(!0),m(T,null,U(o(S).value,e=>(p(),m("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),m("img",{key:0,src:e.image_uris.normal},null,8,Ne)):w("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),m("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Le)):w("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),m("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Fe)):w("",!0),s("p",Ee,b(e.name),1),s("p",null,b(e.set_name),1),s("p",null,b(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var Pe=Z(Be,[["__scopeId","data-v-a0cb9eb6"]]);const Re={setup(f){return(g,n)=>(p(),Q(Pe))}},Ae=X(Re);Ae.mount("#app");
