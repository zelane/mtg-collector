var ce=Object.defineProperty;var se=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var oe=($,_,y)=>_ in $?ce($,_,{enumerable:!0,configurable:!0,writable:!0,value:y}):$[_]=y,J=($,_)=>{for(var y in _||(_={}))ue.call(_,y)&&oe($,y,_[y]);if(se)for(var y of se(_))de.call(_,y)&&oe($,y,_[y]);return $};import{r as O,w as pe,o as C,c as k,a as o,t as U,u as t,n as A,F as G,b as j,d as M,v as R,e as z,f as I,g as B,k as L,h as F,i as fe,j as H,P as Q,l as ne,p as ae,m as re,q as X,s as me,D as _e,x as ve,y as Y,z as Z,A as ye,B as he}from"./vendor.8178ad76.js";const ge=function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))g(e);new MutationObserver(e=>{for(const h of e)if(h.type==="childList")for(const V of h.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&g(V)}).observe(document,{childList:!0,subtree:!0});function y(e){const h={};return e.integrity&&(h.integrity=e.integrity),e.referrerpolicy&&(h.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?h.credentials="include":e.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function g(e){if(e.ep)return;e.ep=!0;const h=y(e);fetch(e.href,h)}};ge();const be={class:"filter-group colours"},Ce={class:"header"},ke=["data-colour"],we=["value","id"],$e=["for"],xe={props:{modelValue:{type:Object,default:()=>({colours:[],or:!1})}},emits:["update:modelValue"],setup($,{emit:_}){const y={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},g=O({colours:[],or:!1}),e={Azorius:["U","W"],Boros:["R","W"],Dimir:["B","U"],Golgari:["B","G"],Gruul:["G","R"],Izzet:["R","U"],Orzhov:["B","W"],Rakdos:["B","R"],Selesnya:["G","W"],Simic:["G","U"]},h={Abzan:["B","G","W"],Bant:["G","U","W"],Esper:["B","U","W"],Grixis:["B","R","U"],Jeskai:["R","U","W"],Jund:["B","G","R"],Mardu:["B","R","W"],Naya:["G","R","W"],Sultai:["B","G","U"],Temur:["G","R","U"]},V={Glint:"W",Dune:"U",Ink:"B",Witch:"R",Yore:"G"};pe(()=>{_("update:modelValue",g)});const N=P=>{let v=[...P].sort();if(P.length===2){for(const[d,n]of Object.entries(e))if(v.every((a,p)=>a===n[p]))return d}else if(P.length===3){for(const[d,n]of Object.entries(h))if(v.every((a,p)=>a===n[p]))return d}else if(P.length===4){for(const[d,n]of Object.entries(V))if(!P.includes(n))return d}};return(P,v)=>(C(),k("div",be,[o("div",Ce,[o("h3",null,U(t(g).colours.length>1?`${N(t(g).colours)}`:""),1),o("div",{class:A(["bi-toggle",{active:t(g).or}]),onClick:v[0]||(v[0]=d=>t(g).or=!t(g).or)},U(t(g).or?"And":"Or"),3)]),(C(),k(G,null,j(y,d=>o("div",{class:A(["input-group colour",t(g).colours.includes(d)?"selected":""]),"data-colour":d,key:d},[M(o("input",{type:"checkbox","onUpdate:modelValue":v[1]||(v[1]=n=>t(g).colours=n),value:d,id:d},null,8,we),[[R,t(g).colours]]),o("label",{for:d,class:A("icon icon-"+d)},null,10,$e)],10,ke)),64))]))}};const Se={class:"filter-group rarities"},Ue=["data-rarity"],Ve=["onUpdate:modelValue","value","id"],Te=["for","title"],Me={class:"filter-group"},Fe={class:"filter-group mana"},Pe={class:"filter-group price"},Ge={class:"filter-group"},Ne={class:"filter-group"},Ee={class:"filter-group"},Oe={class:"filter-group"},Ae={key:0,class:"filter-group compare"},Be={class:"header"},je=o("h3",null,"Compare",-1),Ie={class:"grid"},Le=["id","onUpdate:modelValue"],Re=["for"],ze=["id","onUpdate:modelValue"],De=["for"],We={class:"filter-group"},Ke=o("h3",null,"Foils",-1),qe={props:{cards:{type:Array,default:()=>[]},collections:{type:Array,default:()=>[]},sort:{type:String,default:"Price"},db:{type:Object,default:()=>{}},filters:{type:Object,default:()=>{}}},emits:["change","loading"],setup($,{emit:_}){const y=$;let g=O({keywords:[],sets:[],tribes:[],allSets:[]}),e=O({colours:{colours:[],or:!1},rarity:[],foils:!1,keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:{value:[null,null],min:0,max:20},price:{value:[null,null],min:0,max:100},dupesOnly:!1,sort:"Price",incCol:{},excCol:{},ors:{}});const h=["special","mythic","rare","uncommon","common"];z(y.filters,d=>{e.sets=d.sets});const V=async(d,n)=>{const a=new Request(n);let p=await d.match(a);return p||(await d.add(a),p=await d.match(a)),await p.json()};caches.open("cardDataCache").then(async d=>{let n=await V(d,"https://api.scryfall.com/catalog/creature-types");g.tribes=n.data,g.tribes=g.tribes.concat(["Enchantment","Sorcery","Land","Creature","Instant","Artifact"]);let a=await V(d,"https://api.scryfall.com/sets");g.allSets=a.data});const N=(d,n)=>{if(e.sort==="Price")return d.price?d.price<n.price?1:-1:!0;if(e.sort==="Mana")return parseFloat(d.cmc)<parseFloat(n.cmc)?1:-1;if(e.sort==="Count")return parseFloat(d.count)===parseFloat(n.count)?d.price<n.price?1:-1:parseFloat(d.count)<parseFloat(n.count)?1:-1},P=async(d,n)=>new Promise(async a=>{let p=setTimeout(()=>_("loading"),300),r=d.sort(N);if(n.cardText&&n.cardText!==""){const i=new fe(r,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});r=[],i.search(n.cardText).forEach(m=>{r.push(m.item)})}for(const i of Object.keys(n.incCol)){if(!n.incCol[i])continue;const w=(await y.db.collections.get({name:i})).cards.map(S=>S.oracle_id);r=r.filter(S=>w.includes(S.oracle_id))}for(const i of Object.keys(n.excCol)){if(!n.excCol[i])continue;const w=(await y.db.collections.get({name:i})).cards.map(S=>S.oracle_id);r=r.filter(S=>!w.includes(S.oracle_id))}let c=0,f=0;r=r.filter(i=>{if(n.dupesOnly&&i.count===1||!(!n.foils||i.is_foil)||!(!n.name||!n.name!=""||i.name.toLowerCase().includes(n.name.toLowerCase())))return!1;const S=l=>n.colours.or?n.colours.colours.every(l):n.colours.colours.some(l);if(n.colours.colours.length>0&&!S(s=>s==="C"?i.color_identity.length===0:(i.color_identity||[]).includes(s))||!n.keywords.every(l=>(i.keywords||[]).includes(l)))return!1;const q=n.tribes.some(l=>(i.type_line.toLowerCase()||"").includes(l.toLowerCase()));if(n.tribes.length>0&&!q||!(n.rarity.length>0?[...n.rarity].includes(i.rarity):!0))return!1;let W=!0;return n.sets.length>0&&(W=n.sets.some(l=>i.set===l)),!W||!(i.cmc>=(n.mana.value[0]||0)&&i.cmc<=(n.mana.value[1]||20))||!(i.price>=(n.price.value[0]||0)&&i.price<=(n.price.value[1]||9999))?!1:(f+=i.price*(i.count||1),!0)}),f=parseInt(f),c=r.length,clearTimeout(p),a([r,c,f])});z(()=>y.cards,async(d,n)=>{const a=new Set,p=[];let r=.9;d.forEach(m=>{m.prices?m.is_foil?m.price=parseFloat(m.prices.eur_foil||parseFloat(m.prices.usd_foil)*r||0):m.price=parseFloat(m.prices.eur||parseFloat(m.prices.usd)*r||0):m.price=0,m.keywords.forEach(w=>{a.add(w)}),p[m.set]=m.set_name}),e.keywords=[],e.sets=[],g.keywords=[...a],g.sets=Object.keys(p).map(m=>({set:m,setName:p[m]}));let[c,f,i]=await P(d,e);_("change",c,f,i)}),z(()=>y.sort,(d,n)=>{e.sort=d});let v=null;return z(e,async()=>{clearTimeout(v),v=setTimeout(async()=>{let[d,n,a]=await P(y.cards,e);_("change",d,n,a)},500)}),(d,n)=>(C(),k(G,null,[I(xe,{modelValue:t(e).colours,"onUpdate:modelValue":n[0]||(n[0]=a=>t(e).colours=a)},null,8,["modelValue"]),o("div",Se,[(C(),k(G,null,j(h,a=>o("div",{class:"input-group rarity","data-rarity":a,key:a},[M(o("input",{type:"checkbox","onUpdate:modelValue":p=>t(e).rarity=p,value:a,id:a},null,8,Ve),[[R,t(e).rarity]]),o("label",{for:a,title:a},null,8,Te)],8,Ue)),64))]),o("div",Me,[M(o("input",{type:"search","onUpdate:modelValue":n[1]||(n[1]=a=>t(e).name=a),placeholder:"Name"},null,512),[[B,t(e).name]])]),o("div",Fe,[M(o("input",{type:"number","onUpdate:modelValue":n[2]||(n[2]=a=>t(e).mana.value[0]=a),placeholder:"Mana (min)"},null,512),[[B,t(e).mana.value[0]]]),M(o("input",{type:"number","onUpdate:modelValue":n[3]||(n[3]=a=>t(e).mana.value[1]=a),placeholder:"Mana (max)"},null,512),[[B,t(e).mana.value[1]]])]),o("div",Pe,[M(o("input",{type:"number","onUpdate:modelValue":n[4]||(n[4]=a=>t(e).price.value[0]=a),placeholder:"Price (min)"},null,512),[[B,t(e).price.value[0]]]),M(o("input",{type:"number","onUpdate:modelValue":n[5]||(n[5]=a=>t(e).price.value[1]=a),placeholder:"Price (max)"},null,512),[[B,t(e).price.value[1]]])]),o("div",Ge,[I(t(L),{modelValue:t(e).tribes,"onUpdate:modelValue":n[6]||(n[6]=a=>t(e).tribes=a),options:t(g).tribes,searchable:!0,mode:"tags","create-option":!0,placeholder:"Types"},null,8,["modelValue","options"])]),o("div",Ne,[I(t(L),{modelValue:t(e).keywords,"onUpdate:modelValue":n[7]||(n[7]=a=>t(e).keywords=a),options:t(g).keywords,searchable:!0,mode:"tags",placeholder:"Keywords"},null,8,["modelValue","options"])]),o("div",Ee,[M(o("input",{type:"search","onUpdate:modelValue":n[8]||(n[8]=a=>t(e).cardText=a),placeholder:"Card text"},null,512),[[B,t(e).cardText]])]),o("div",Oe,[I(t(L),{modelValue:t(e).sets,"onUpdate:modelValue":n[9]||(n[9]=a=>t(e).sets=a),options:t(g).sets,label:"setName","value-prop":"set",searchable:!0,mode:"tags",placeholder:"Sets"},null,8,["modelValue","options"])]),$.collections.length>0?(C(),k("div",Ae,[o("div",Be,[je,o("a",{href:"#",onClick:n[10]||(n[10]=()=>{t(e).incCol={},t(e).excCol={}})},"X")]),o("div",Ie,[(C(!0),k(G,null,j($.collections,a=>(C(),k(G,{key:a},[o("div",null,U(a),1),o("div",null,[M(o("input",{type:"checkbox",id:a+"-inc","onUpdate:modelValue":p=>t(e).incCol[a]=p,value:!1},null,8,Le),[[R,t(e).incCol[a]]]),o("label",{class:"inc",for:a+"-inc"},null,8,Re)]),o("div",null,[M(o("input",{type:"checkbox",id:a+"-exc","onUpdate:modelValue":p=>t(e).excCol[a]=p,value:!1},null,8,ze),[[R,t(e).excCol[a]]]),o("label",{class:"exc",for:a+"-exc"},null,8,De)])],64))),128))])])):F("",!0),o("div",We,[Ke,M(o("input",{type:"checkbox","onUpdate:modelValue":n[11]||(n[11]=a=>t(e).foils=a)},null,512),[[R,t(e).foils]])])],64))}};var ee=($,_)=>{const y=$.__vccOpts||$;for(const[g,e]of _)y[g]=e;return y};const ie=$=>(ae("data-v-cf5a7f16"),$=$(),re(),$),Je={class:"upload"},Qe=ie(()=>o("span",null,"+",-1)),Ze=[Qe],He={class:"collections"},Xe=["onClick"],Ye=["onClick"],et={key:0,class:"form"},tt=ie(()=>o("h3",null,"Format",-1)),st={key:1,class:"button",for:"file-input"},ot=["disabled"],lt={key:3,class:"buttons"},nt={key:4,class:"progress"},at={props:{db:Object,collections:Array,setIds:Set},emits:["change","delete","close"],setup($,{emit:_}){const y=$,g="https://api.scryfall.com/cards/collection",e=O({name:null,file:null,text:`1 Golgari Signet
1 Hornet Nest `,append:!0,encoding:null,format:"MTGO",active:!1,progress:0,count:0,total:0});O({name:null,upload:!1});const h=async(p="",r={})=>(await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json(),V=async p=>{let r=await p.arrayBuffer(),c=new Uint8Array(r.slice(0,10));return c[0].toString(16)=="ff"&&c[1].toString(16)=="fe"?"UTF-16LE":c[0].toString(16)=="fe"&&c[1].toString(16)=="ff"?"UTF-16BE":c[1]==0&&c[3]==0&&c[5]==0?"UTF-16LE":"UTF-8"},N=async p=>{e.active=!0,e.progress=0;let r={};if(e.format==="MTGA"){const c=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,f=e.text.matchAll(c);for(const i of f)r[i[3]+i[4]]={name:i[2].split(" // ")[0].trim(),count:parseInt(i[1]),set:i[3],number:i[4],foil:!1}}else if(e.format==="MTGO"){const c=/([0-9]+) (.+)/g,f=e.text.matchAll(c);for(const i of f)r[i[2]]={name:i[2].split(" // ")[0].trim(),count:parseInt(i[1])||1,set:"",number:"",foil:!1}}else if(e.format==="MKM Email"){const c=/([0-9]+)x ([a-zA-Z ]+)/g,f=e.text.matchAll(c);for(const i of f)r[i[2]]={name:i[2].replace(" Token","").trim(),count:parseInt(i[1])||1,set:"",number:"",foil:!1}}a(e.name,r)},P=async p=>{if(v.value.files.length===0)return;let r=v.value.files[0];const c=new FileReader;e.active=!0,e.progress=0;let f=null;e.format==="DragonShield Web"&&(f=d),c.onload=async()=>{let m=await f(c.result);a(e.name,m)};let i=await V(r);c.readAsText(r,i)},v=H(null);Q.parsePromise=p=>new Promise((r,c)=>{Q.parse(p,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:r,error:c})});const d=async p=>{p=p.replace('"sep=,"',"");let r=await Q.parsePromise(p),c={};return r.data.forEach(f=>{const i=f["Set Name"];let m=f["Set Code"].toLowerCase();y.setIds.has(m)?c[m+f["Card Number"]]={name:f["Card Name"],count:parseInt(f.Quantity),set:m,number:f["Card Number"].toString(),foil:f.Printing==="Foil"}:(console.log(`Couldn't find set for ${f["Card Name"]} ${f["Card Number"]} ${i} [${m}]`),c[m+f["Card Number"]]={name:f["Card Name"],count:parseInt(f.Quantity),set:"",number:"",foil:f.Printing==="Foil"})}),c},n=async p=>{const r=[],c={},f=new Set;try{let i=[];for(const[m,w]of Object.entries(p)){let S={};w.set===""&&w.number===""?(S.name=w.name,c[w.name]=w.count):(S.set=w.set,S.collector_number=w.number,c[w.set+w.number]=w.count,w.foil&&f.add(w.set+w.number)),r.push(S)}e.total=r.length;for(let m=0;m<r.length;m+=75){const w=await h(g,{identifiers:r.slice(m,m+75)});w.not_found.length>0&&console.log(w.not_found);let S=w.data.map(T=>(T.count=c[T.name]||c[T.set+T.collector_number]||1,T.is_foil=f.has(T.set+T.collector_number),T));i=i.concat(S),e.count=m,e.progress=m/r.length*100,await new Promise(T=>setTimeout(T,100))}return e.progress=100,i}catch(i){console.error(i)}finally{e.active=!1,e.count=0,e.progress=0,e.total=0,_("close")}},a=async(p,r,c=null)=>{let f=[];if(c||(c=e.append),c&&y.collections.includes(p)){const i=await y.db.collections.get({name:p});f=i.cards;for(const[m,w]of Object.entries(r)){let S=i.cards.filter(T=>T===void 0?!1:w.set!==""?w.set===T.set&&w.number===T.collector_number:T.name===w.name);S.length>0&&(S[0].count=w.count,delete r[m])}}if(r){const i=await n(r);f=f.concat(i)}console.log(p,f),_("change",p,f)};return(p,r)=>(C(),k("div",Je,[o("button",{class:"small close",onClick:r[0]||(r[0]=c=>_("close"))},Ze),o("div",He,[(C(!0),k(G,null,j(y.collections,c=>(C(),k("div",{class:"collection",key:c},[o("div",null,U(c),1),o("a",{class:"action",onClick:f=>t(e).name=c},"+",8,Xe),o("a",{class:"action",onClick:f=>_("delete",[c])},"-",8,Ye)]))),128))]),o("a",{href:"#",onClick:r[1]||(r[1]=c=>t(e).name=" ")},"New collection"),t(e).name?(C(),k("div",et,[o("h3",null,U(y.collections.includes(t(e).name)?"Add to":"Name"),1),M(o("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=c=>t(e).name=c)},null,512),[[B,t(e).name]]),tt,I(t(L),{modelValue:t(e).format,"onUpdate:modelValue":r[3]||(r[3]=c=>t(e).format=c),options:["DragonShield Web","DragonShield Mobile","MKM Email","MTGA","MTGO"],"can-clear":!1},null,8,["modelValue"]),["MTGA","MTGO","MKM Email"].includes(t(e).format)?M((C(),k("textarea",{key:0,"onUpdate:modelValue":r[4]||(r[4]=c=>t(e).text=c)},null,512)),[[B,t(e).text]]):F("",!0),["DragonShield Web","DragonShield Mobile"].includes(t(e).format)?(C(),k("label",st,"Choose file")):F("",!0),t(e).format==="DragonShield Web"?(C(),k("input",{key:2,id:"file-input",ref_key:"fileElem",ref:v,type:"file",disabled:t(e).active},null,8,ot)):F("",!0),!t(e).active&&t(e).format&&(t(e).text||v.value)?(C(),k("div",lt,[o("button",{onClick:r[5]||(r[5]=c=>["MTGA","MTGO","MKM Email"].includes(t(e).format)?N():P())}," Upload ")])):F("",!0),t(e).active?(C(),k("div",nt,[o("span",null,"Processing cards: "+U(t(e).count)+" / "+U(t(e).total),1),o("div",{class:"bar",style:ne({width:t(e).progress+"%"})},null,4)])):F("",!0)])):F("",!0)]))}};var rt=ee(at,[["__scopeId","data-v-cf5a7f16"]]);const it={key:0,class:"loader"},ct={class:"img"},ut=["src"],dt=["src"],pt=["src"],ft={class:"buttons"},mt=["onClick"],_t=["onClick"],vt={class:"name"},yt={class:"set"},ht={props:{cards:Array,zoom:Number,loading:Boolean},emits:["clip","viewPrints"],setup($,{emit:_}){const y=$;return(g,e)=>(C(),k(G,null,[y.loading?(C(),k("div",it," Loading ")):F("",!0),o("div",{class:"cards",style:ne({"font-size":18+y.zoom*2+"px"})},[(C(!0),k(G,null,j(y.cards.slice(0,500),h=>(C(),k("div",{class:A(["card",{foil:h.is_foil}]),key:h.id},[o("div",ct,[h.image_uris?(C(),k("img",{key:0,src:h.image_uris.normal},null,8,ut)):F("",!0),h.card_faces&&h.card_faces[0].image_uris?(C(),k("img",{key:1,class:"flip front",src:h.card_faces[0].image_uris.normal},null,8,dt)):F("",!0),h.card_faces&&h.card_faces[0].image_uris?(C(),k("img",{key:2,class:"flip back",src:h.card_faces[1].image_uris.normal},null,8,pt)):F("",!0),o("div",ft,[o("button",{class:"small prints icon icon-prints",onClick:X(V=>{_("viewPrints",h.name)},["stop"]),title:"View all prints"},null,8,mt),o("button",{class:"small clip icon icon-add",onClick:X(V=>_("clip",h),["stop"]),title:"Add to clipboard"},null,8,_t)])]),o("p",vt,U(h.count)+" "+U(h.name)+" "+U(h.is_foil?"\u2606":""),1),o("p",null,U(h.set_name),1),o("p",null,[me(U(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(h.price))+" ",1),o("span",yt,U(h.set)+":"+U(h.collector_number),1)])],2))),128))],4)],64))}};var le=ee(ht,[["__scopeId","data-v-1a7d7548"]]);const K=$=>(ae("data-v-7153a0e2"),$=$(),re(),$),gt={id:"window"},bt={id:"sidebar"},Ct={class:"filter-group cards"},kt={class:"selector tabs"},wt=["onClick"],$t={class:"view"},xt={key:0,class:"item collection"},St={key:1,class:"item"},Ut={key:2,class:"item"},Vt={id:"main"},Tt={class:"info-bar"},Mt={class:"sort"},Ft={class:"menu"},Pt=["onClick"],Gt={class:"settings"},Nt=K(()=>o("h3",null,"Settings",-1)),Et={class:"zoom"},Ot=K(()=>o("label",{for:"zoom"},"Zoom",-1)),At={class:"prints"},Bt=K(()=>o("h3",null,"Prints",-1)),jt={key:0,class:"info"},It=K(()=>o("h3",null,"Selection info",-1)),Lt={class:"sets"},Rt=["src"],zt=["onClick"],Dt={class:"clipboard"},Wt={class:"clip-cards"},Kt={class:"buttons"},qt={class:"menu-button"},Jt={class:"menu-button"},Qt=["onClick"],Zt={setup($){const _=new _e("mtg");_.version(2).stores({collections:"&name"});const y=O({count:0,total_value:0}),g=O({cards:new Map}),e=O({upload:!1,clipboard:!1,prints:!1,sidebarShow:!1,sidebar:"clipboard",menu:!1,random:{},cards:"collection",zoom:0}),h=O({sets:[]}),V=new Map;let N=H(!1),P=H(!1);const v=O({collections:[],all:[],filtered:[],sort:"Price",prints:[]});let d=O({value:[]});const n=async(u,l)=>{const s=new Request(l);let b=await u.match(s);return b||(await u.add(s),b=await u.match(s)),await b.json()},a=async u=>{if(u===[])return;let l=new Map;for(const s of u){let b=await _.collections.get({name:s});for(const x of b.cards)if(x!==void 0)if(l.has(x.id)){let E=l.get(x.id);E.count=parseInt(E.count)+parseInt(x.count),l.set(x.id,E)}else l.set(x.id,x)}v.all=[...l.values()]},p=async u=>{r("e:"+u)},r=async(u,l="prints")=>{let s="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:`${u} -border:silver -is:digital`,unique:l}),b=[];N.value=!0;try{for(;;){let x=await n(m,s);if(b=b.concat(x.data),!x.has_more)break;s=x.next_page,await new Promise(E=>setTimeout(E,100))}v.all=b}finally{N.value=!1}},c=async(u,l="prints")=>{let s="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:`!"${u}" -border:silver -is:digital`,unique:l}),b=[];e.sidebar="prints",e.sidebarShow=!0,P.value=!0;try{for(;;){let x=await n(m,s);if(b=b.concat(x.data),!x.has_more)break;s=x.next_page,await new Promise(E=>setTimeout(E,100))}b.forEach(x=>{x.price=parseFloat(x.prices.eur||parseFloat(x.prices.usd)*.9||0)}),v.prints=b.sort((x,E)=>x.price<E.price?1:-1)}finally{P.value=!1}},f=async u=>{if(confirm(`Are you sure you want to delete ${u.join(", ")}?`))u.map(async l=>{await _.collections.delete(l),v.collections.splice(v.collections.indexOf(l),1),d.value.splice(d.value.indexOf(l),1)});else return};z(d,u=>a(u.value));const i=async(u,l,s)=>{y.count=l,y.total_value=s,v.filtered=u,N.value=!1};_.collections.toCollection().primaryKeys().then(u=>{u.length!==0&&(v.collections=u,v.collections.sort(),d.value=[u[0]])});let m=null;caches.open("cardDataCache").then(async u=>{m=u,(await n(u,"https://api.scryfall.com/sets")).data.forEach(s=>V.set(s.code,s))});const w=async(u,l)=>{await _.collections.put({name:u,cards:l}),v.collections.includes(u)||v.collections.push(u),v.collections.sort(),d.value=[u]},S=async u=>{let l="";if(u==="mtgo")for(const s of g.cards.values())l+=`${s.count||1} ${s.name} 
`;else if(u==="mtga")for(const s of g.cards.values())l+=`${s.count||1} ${s.name} (${s.set}) ${s.collector_number}
`;else if(u==="mkm")for(const s of g.cards.values())l+=`${s.count||1} ${s.name} (${s.set_name})
`;else if(u==="moxfield"){l=`"Count","Tradelist Count","Name","Edition","Condition","Language","Foil","Tags","Last Modified","Collector Number"
`;for(const s of g.cards.values())l+=`"${s.count||1}","0","${s.name}","${s.set}","Near Mint","English","","","2022-03-22 02:52:33.210000","${s.collector_number}"
`}navigator.clipboard.writeText(l)},T=async(u,l)=>{let s=await _.collections.get({name:u});for(const b of l){console.log(b);let x=s.cards.filter(E=>E.id===b.id);x.length===0?s.cards.push(J({},ye.deepUnref(b))):x[0].count+=b.count||1}await _.collections.put(s),d.value.includes(u)&&(v.all=v.all.concat(newCard))},q=u=>{const l=u.reduce((s,b)=>{const x=s.get(b.set);return s.set(b.set,x?x+1:1),s},new Map);return new Map([...l.entries()].sort((s,b)=>s[1]>b[1]?-1:1))},D=(u,l=!1)=>{u.forEach(s=>{let b=g.cards.get(s.id);s.price||(s.price=parseFloat(s.prices.eur||parseFloat(s.prices.usd)*.9||0)),b?b.count+=l&&s.count||1:(b=J({},s),s.count||(b.count=1)),g.cards.set(b.id,b)})},W=u=>{u===e.sidebar?e.sidebarShow=!e.sidebarShow:(e.sidebarShow=!0,e.sidebar=u)},te=u=>{e.cards!==u&&(e.cards=u,u==="collection"?a(d.value):u==="set"?e.set&&p(e.set):u==="search"&&e.search&&r(e.search))};return(u,l)=>(C(),k("div",gt,[o("div",bt,[o("div",Ct,[o("div",kt,[(C(),k(G,null,j(["collection","set","search"],s=>o("a",{href:"#",key:s,onClick:b=>te(s),class:A({selected:t(e).cards===s})},U(s),11,wt)),64))]),o("div",$t,[t(e).cards==="collection"?(C(),k("div",xt,[I(t(L),{modelValue:t(d).value,"onUpdate:modelValue":l[0]||(l[0]=s=>t(d).value=s),options:t(v).collections,mode:"tags",searchable:!0},null,8,["modelValue","options"]),o("button",{class:"small add icon icon-settings",onClick:l[1]||(l[1]=s=>t(e).upload=!t(e).upload)})])):F("",!0),t(e).cards==="set"?(C(),k("div",St,[I(t(L),{modelValue:t(e).set,"onUpdate:modelValue":l[2]||(l[2]=s=>t(e).set=s),options:[...t(V).values()],searchable:!0,label:"name","value-prop":"code",mode:"single",onSelect:p,onLoading:l[3]||(l[3]=s=>t(N).value=!0)},null,8,["modelValue","options"])])):F("",!0),t(e).cards==="search"?(C(),k("div",Ut,[M(o("input",{type:"search","onUpdate:modelValue":l[4]||(l[4]=s=>t(e).search=s),onKeyup:l[5]||(l[5]=ve(s=>r(s.currentTarget.value,"cards"),["enter"]))},null,544),[[B,t(e).search]])])):F("",!0)])]),I(qe,{onChange:i,cards:t(v).all,collections:t(v).collections,db:t(_),sort:t(v).sort,filters:t(h)},null,8,["cards","collections","db","sort","filters"])]),o("div",Vt,[t(e).upload?(C(),Y(rt,{key:0,onChange:w,onClose:l[6]||(l[6]=s=>t(e).upload=!1),onDelete:f,db:t(_),collections:t(v).collections,"set-ids":new Set(t(V).keys())},null,8,["db","collections","set-ids"])):F("",!0),o("div",Tt,[o("span",null,"Count: "+U(t(y).count),1),o("span",null,"Value: "+U(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(t(y).total_value)),1),o("span",Mt,[I(t(L),{modelValue:t(v).sort,"onUpdate:modelValue":l[7]||(l[7]=s=>t(v).sort=s),options:["Mana","Price","Count"],mode:"single","can-clear":!1},null,8,["modelValue"])])]),o("div",{class:A(["sidepanel",{show:t(e).sidebarShow}])},[o("div",Ft,[(C(),k(G,null,j(["clipboard","prints","settings"],s=>o("div",{class:A(["item",s]),onClick:X(b=>W(s),["stop"]),key:s},[o("span",{class:A(["icon","icon-"+s])},null,2)],10,Pt)),64))]),M(o("div",Gt,[Nt,o("span",Et,[Ot,M(o("input",{id:"zoom",type:"number","onUpdate:modelValue":l[8]||(l[8]=s=>t(e).zoom=s)},null,512),[[B,t(e).zoom]])])],512),[[Z,t(e).sidebar==="settings"]]),M(o("div",At,[Bt,I(le,{cards:t(v).prints,loading:t(P),zoom:1,onClip:l[9]||(l[9]=s=>D([s]))},null,8,["cards","loading"])],512),[[Z,t(e).sidebar==="prints"]]),t(e).sidebar==="info"?(C(),k("div",jt,[It,o("div",Lt,[(C(!0),k(G,null,j(q(t(v).filtered).entries(),([s,b])=>(C(),k("div",{class:"set",key:s},[o("img",{src:t(V).get(s).icon_svg_uri},null,8,Rt),o("a",{href:"#",onClick:x=>t(h).sets=[s]},U(t(V).get(s).name),9,zt),o("span",null,U(b),1)]))),128))])])):F("",!0),M(o("div",Dt,[o("h3",null,"Clipboard "+U(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format([...t(g).cards.values()].reduce((s,b)=>s+=b.price*b.count,0))),1),o("div",Wt,[(C(!0),k(G,null,j(t(g).cards.values(),s=>(C(),k("div",{class:"clip-card",key:"clip-"+s.name},[o("p",null,U(s.count)+"x "+U(s.name)+" ("+U(s.set)+")",1)]))),128))]),o("div",Kt,[o("div",qt,[o("button",{onClick:l[10]||(l[10]=s=>t(e).random.clipExports=!t(e).random.clipExports)}," Export "),o("div",{class:A(["v-menu",{show:t(e).random.clipExports}])},[o("button",{onClick:l[11]||(l[11]=s=>S("mtgo"))}," MTGO "),o("button",{onClick:l[12]||(l[12]=s=>S("mtga"))}," MTGA "),o("button",{onClick:l[13]||(l[13]=s=>S("mkm"))}," MKM + Set "),o("button",{onClick:l[14]||(l[14]=s=>S("moxfield"))}," Mox ")],2)]),o("div",Jt,[o("button",{onClick:l[15]||(l[15]=s=>t(e).random.addToSet=!t(e).random.addToSet)}," Add to set "),o("div",{class:A(["v-menu",{show:t(e).random.addToSet}])},[(C(!0),k(G,null,j(t(v).collections,s=>(C(),k("button",{onClick:b=>T(s,t(g).cards.values()),key:s},U(s),9,Qt))),128))],2)]),o("button",{onClick:l[16]||(l[16]=s=>D(t(v).filtered,!0))}," Clip All "),o("button",{onClick:l[17]||(l[17]=s=>t(g).cards.clear())}," Clear ")])],512),[[Z,t(e).sidebar==="clipboard"]])],2),o("div",{onClick:l[20]||(l[20]=s=>t(e).sidebarShow=!1)},[t(e).upload===!1?(C(),Y(le,{key:0,cards:t(v).filtered,zoom:t(e).zoom,loading:t(N),onClip:l[18]||(l[18]=s=>D([s])),onViewPrints:l[19]||(l[19]=s=>c(s))},null,8,["cards","zoom","loading"])):F("",!0)])])]))}};var Ht=ee(Zt,[["__scopeId","data-v-7153a0e2"]]);const Xt={setup($){return(_,y)=>(C(),Y(Ht))}},Yt=he(Xt);Yt.mount("#app");
