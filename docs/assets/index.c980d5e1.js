import{r as M,a as U,D as $,w as q,F as H,o as p,c as _,b as s,u as o,d as x,t as f,n as X,e as E,f as B,g as C,v as F,h as I,k as R,p as z,i as J,P as Q,j,l as Y,m as Z}from"./vendor.84f3b61b.js";const ee=function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const b of u.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function m(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(r){if(r.ep)return;r.ep=!0;const u=m(r);fetch(r.href,u)}};ee();var te=(y,h)=>{const m=y.__vccOpts||y;for(const[l,r]of h)m[l]=r;return m};const v=y=>(z("data-v-01a0dacb"),y=y(),J(),y),se={id:"window"},oe={id:"sidebar"},re={key:0,for:"upload"},ae={key:1,class:"progress"},ne=v(()=>s("br",null,null,-1)),le={class:"filter-group"},ie=v(()=>s("h3",null,"Colours",-1)),ce={class:"input-group",key:"code"},de=["value","id"],ue=["for"],pe={class:"filter-group"},_e=v(()=>s("h3",null,"Rarity",-1)),ye={class:"input-group",key:"code"},he=["onUpdate:modelValue","value","id"],me=["for"],fe={class:"filter-group"},ve=v(()=>s("h3",null,"Name",-1)),ge={class:"filter-group"},we=v(()=>s("h3",null,"Keywords",-1)),ke={class:"filter-group"},be=v(()=>s("h3",null,"Types",-1)),xe={class:"filter-group"},Ce=v(()=>s("h3",null,"Card text",-1)),Ve={class:"filter-group"},Se=v(()=>s("h3",null,"Set",-1)),Te={id:"main"},Ue={class:"cards"},Le=["src"],Ne=["src"],Ee=["src"],Be={class:"name"},Fe={props:{},setup(y){const h="https://api.scryfall.com/cards/collection",m=M(null);let l=U({active:!1,progress:0,count:0,total:0});const r=new $("mtg");r.version(4).stores({cards:"++id, name, prices.eur, type_line, color_identity, keywords, rarity"});const u={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"X"},b=["mythic","rare","uncommon","common"];let P=new Set,V=U({tribes:[],keywords:[]}),i=U({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",set:""}),S=[],T=U({value:[]});r.cards.toArray().then(async c=>{S=c,T.value=await L(S,i)});let O=null;q(i,async c=>{clearTimeout(O),O=setTimeout(async()=>{T.value=await L(S,c)},500)}),fetch("https://api.scryfall.com/catalog/creature-types").then(c=>c.json()).then(c=>{V.tribes=c.data}),r.cards.orderBy("keywords").uniqueKeys(c=>{c.forEach(t=>{t.forEach(e=>{P.add(e)})}),V.keywords=[...P]});async function A(c="",t={}){return(await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}const L=async(c,t)=>new Promise((e,g)=>{let d=c;if(d.sort((n,a)=>n.prices.eur?parseFloat(n.prices.eur)<parseFloat(a.prices.eur):!0),t.cardText&&t.cardText!=""){const n=new H(d,{ignoreLocation:!0,threshold:.5,keys:["oracle_text","card_faces.oracle_text"]});d=[],n.search(t.cardText).forEach(a=>{d.push(a.item)})}d=d.filter(n=>{const a=!t.name||!t.name!=""||n.name.toLowerCase().includes(t.name.toLowerCase()),w=t.colours.every(k=>k=="X"?n.color_identity.length==0:(n.color_identity||[]).includes(k)),N=t.keywords.every(k=>(n.keywords||[]).includes(k)),K=t.tribes.every(k=>(n.type_line.toLowerCase()||"").includes(k.toLowerCase())),W=t.rarity.length>0?[...t.rarity].includes(n.rarity):!0,G=t.set?n.set==t.set:!0;return w&&N&&K&&W&&a&&G}),e(d.slice(0,200))}),D=async()=>{const c=new FileReader;l.active=!0,l.progress=0,c.onload=t=>{Q.parse(t.target.result,{header:!0,worker:!0,skipEmptyLines:!0,complete:async e=>{let g=new Set,d=[];e.data.forEach(a=>{let w=a["Set Code"]+a["Card Number"].toString();g.has(w)||d.push({set:a["Set Code"],collector_number:a["Card Number"].toString()}),g.add(w)});let n=[];l.total=d.length;for(let a=0;a<d.length;a+=75){let w=await A(h,{identifiers:d.slice(a,a+75)});n=n.concat(w.data),l.count=a,l.progress=a/d.length*100,await new Promise(N=>setTimeout(N,100))}l.progress=100,await r.cards.clear(),n.forEach(a=>{r.cards.add(a)}),S=n,T.value=await L(n,i),l.active=!1}})},c.readAsText(m.value.files[0])};return(c,t)=>(p(),_("div",se,[s("div",oe,[o(l).active?x("",!0):(p(),_("label",re,"Upload CSV")),s("input",{id:"upload",ref_key:"file",ref:m,onChange:t[0]||(t[0]=e=>D()),type:"file"},null,544),o(l).active?(p(),_("div",ae,[s("span",null,"Processing cards: "+f(o(l).count)+" / "+f(o(l).total),1),s("div",{class:"bar",style:X({width:o(l).progress+"%"})},null,4)])):x("",!0),ne,s("div",le,[ie,(p(),_(E,null,B(u,(e,g)=>s("div",ce,[C(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=d=>o(i).colours=d),value:e,id:e},null,8,de),[[j,o(i).colours]]),s("label",{for:e},f(g),9,ue)])),64))]),s("div",pe,[_e,(p(),_(E,null,B(b,e=>s("div",ye,[C(s("input",{type:"checkbox","onUpdate:modelValue":g=>o(i).rarity=g,value:e,id:e},null,8,he),[[j,o(i).rarity]]),s("label",{for:e},f(e),9,me)])),64))]),s("div",fe,[ve,C(s("input",{type:"search","onUpdate:modelValue":t[2]||(t[2]=e=>o(i).name=e)},null,512),[[F,o(i).name]])]),s("div",ge,[we,I(o(R),{modelValue:o(i).keywords,"onUpdate:modelValue":t[3]||(t[3]=e=>o(i).keywords=e),options:o(V).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),s("div",ke,[be,I(o(R),{modelValue:o(i).tribes,"onUpdate:modelValue":t[4]||(t[4]=e=>o(i).tribes=e),options:o(V).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),s("div",xe,[Ce,C(s("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>o(i).cardText=e)},null,512),[[F,o(i).cardText]])]),s("div",Ve,[Se,C(s("input",{type:"search","onUpdate:modelValue":t[6]||(t[6]=e=>o(i).set=e)},null,512),[[F,o(i).set]])])]),s("div",Te,[s("div",Ue,[(p(!0),_(E,null,B(o(T).value,e=>(p(),_("div",{class:"card",key:e.id+e.foil},[e.image_uris?(p(),_("img",{key:0,src:e.image_uris.normal},null,8,Le)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,Ne)):x("",!0),e.card_faces&&e.card_faces[0].image_uris?(p(),_("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,Ee)):x("",!0),s("p",Be,f(e.name),1),s("p",null,f(e.set_name)+" ["+f(e.set)+"]",1),s("p",null,f(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))])])]))}};var Pe=te(Fe,[["__scopeId","data-v-01a0dacb"]]);const Oe={setup(y){return(h,m)=>(p(),Y(Pe))}};let Ie=Z(Oe);Ie.mount("#app");
