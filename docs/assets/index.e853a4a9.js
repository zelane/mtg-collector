import{r as T,D as se,w as q,a as oe,P as D,o as c,c as m,b as l,d as S,u as s,k as U,F,e as A,f as M,v as E,g as le,h as v,t as N,n as ae,p as ne,i as re,j as K,l as z,m as ie,q as ue,s as ce}from"./vendor.918b318e.js";const de=function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))y(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const h of f.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&y(h)}).observe(document,{childList:!0,subtree:!0});function o(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerpolicy&&(f.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?f.credentials="include":i.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function y(i){if(i.ep)return;i.ep=!0;const f=o(i);fetch(i.href,f)}};de();var me=(g,b)=>{const o=g.__vccOpts||g;for(const[y,i]of b)o[y]=i;return o};const p=g=>(ne("data-v-49c3d002"),g=g(),re(),g),pe={id:"window"},fe={id:"sidebar"},he={class:"filter-group collections"},_e=p(()=>l("h3",null,"View Collection",-1)),ye={class:"filter-group"},ve=p(()=>l("h3",null,"View Set",-1)),ge=p(()=>l("hr",null,null,-1)),be={class:"filter-group colours"},we=p(()=>l("h3",null,"Colours",-1)),ke=["data-colour"],Ce=["value","id"],Ve=["for"],xe={class:"filter-group rarities"},Se=p(()=>l("h3",null,"Rarity",-1)),Te=["data-rarity"],Ue=["onUpdate:modelValue","value","id"],Me=["for","title"],Ne={class:"filter-group"},Le=p(()=>l("h3",null,"Name",-1)),Pe={class:"filter-group mana"},Ee=p(()=>l("h3",null,"Mana Cost",-1)),Oe={class:"filter-group"},De=p(()=>l("h3",null,"Keywords",-1)),Fe={class:"filter-group"},Ae=p(()=>l("h3",null,"Types",-1)),Ge={class:"filter-group"},Be=p(()=>l("h3",null,"Card text",-1)),je={class:"filter-group"},Re=p(()=>l("h3",null,"Set",-1)),We={id:"main"},Ie={key:0,class:"upload"},$e=p(()=>l("span",null,"+",-1)),qe=[$e],Ke={class:"form"},ze=p(()=>l("h3",null,"Name",-1)),He=p(()=>l("h3",null,"Format",-1)),Je={key:1,class:"button",for:"file-input"},Qe=["disabled"],Xe={key:3,class:"buttons"},Ye={key:4,class:"progress"},Ze={key:1,class:"cards"},et=["src"],tt=["src"],st=["src"],ot={class:"name"},lt={setup(g){const b="https://api.scryfall.com/cards/collection",o=T({show:!1,name:null,file:null,text:null,encoding:null,format:null,active:!1,progress:0,count:0,total:0}),y=new se("mtg");y.version(1).stores({collections:"&name"});const i={Red:"R",Green:"G",Black:"B",Blue:"U",White:"W",Colourless:"C"},f=["special","mythic","rare","uncommon","common"],h=T({tribes:[],keywords:[],sets:[],allSets:[]}),u=T({colours:[],rarity:[],keywords:[],tribes:[],name:"",cardText:"",sets:[],mana:[0,20],dupesOnly:!1}),G=T({value:null}),B=async(n,t)=>new Promise(e=>{let a=n;if(a.sort((r,d)=>r.prices.eur?parseFloat(r.prices.eur)<parseFloat(d.prices.eur)?1:-1:!0),t.cardText&&t.cardText!==""){const r=new ie(a,{ignoreLocation:!0,threshold:.5,findAllMatches:!0,keys:["oracle_text","card_faces.oracle_text"]});a=[],r.search(t.cardText).forEach(d=>{a.push(d.item)})}a=a.filter(r=>{if(t.dupesOnly&&r.count===1||!(!t.name||!t.name!=""||r.name.toLowerCase().includes(t.name.toLowerCase()))||!t.colours.every(C=>C==="C"?r.color_identity.length===0:(r.color_identity||[]).includes(C))||!t.keywords.every(C=>(r.keywords||[]).includes(C))||!t.tribes.every(C=>(r.type_line.toLowerCase()||"").includes(C.toLowerCase()))||!(t.rarity.length>0?[...t.rarity].includes(r.rarity):!0))return!1;let $=!0;return t.sets.length>0&&($=t.sets.some(C=>r.set===C)),!(!$||!(r.cmc>=t.mana[0]&&r.cmc<=t.mana[1]))}),e(a.slice(0,200))});let L=[];const w=T({collections:[],value:[]});let V=T({value:""});const H=async n=>{if(n==="")return;let t=await y.collections.get({name:n});j(t.cards)},J=async n=>{let t="https://api.scryfall.com/cards/search?"+new URLSearchParams({q:"e:"+n}),e=[];for(;;){let a=await O(W,t);if(e=e.concat(a.data),!a.has_more)break;t=a.next_page,await new Promise(r=>setTimeout(r,100))}j(e)},j=async n=>{L=n,w.value=await B(L,u);const t=new Set,e=[];L.forEach(a=>{a.keywords.forEach(r=>{t.add(r)}),e[a.set]=a.set_name}),h.keywords=[...t],h.sets=Object.keys(e).map(a=>({set:a,setName:e[a]}))},Q=async n=>{await y.collections.delete(n),w.collections.pop(n),V.value=""};q(V,n=>H(n.value));let R=null;q(u,async n=>{clearTimeout(R),R=setTimeout(async()=>{w.value=await B(L,n)},500)}),y.collections.toCollection().primaryKeys().then(n=>{n.length!==0&&(w.collections=n,V.value=n[0])});const O=async(n,t)=>{const e=new Request(t);let a=await n.match(e);return a||(await n.add(e),a=await n.match(e)),await a.json()};let W=null;caches.open("cardDataCache").then(async n=>{W=n;let t=await O(n,"https://api.scryfall.com/catalog/creature-types");h.tribes=t.data;let e=await O(n,"https://api.scryfall.com/sets");h.allSets=e.data});const X=async(n="",t={})=>(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),Y=async n=>{let t=await n.arrayBuffer(),e=new Uint8Array(t.slice(0,10));return e[0].toString(16)=="ff"&&e[1].toString(16)=="fe"?"UTF-16LE":e[0].toString(16)=="fe"&&e[1].toString(16)=="ff"?"UTF-16BE":e[1]==0&&e[3]==0&&e[5]==0?"UTF-16LE":"UTF-8"},Z=async n=>{o.active=!0,o.progress=0;let t={};if(o.format==="MTGA"){const e=/([0-9]+) (.+) \((.+)\) ([0-9]+)/g,a=o.text.matchAll(e);for(const r of a)t[r[3]+r[4]]={name:r[2],count:r[1],set:r[3],number:r[4]}}else if(o.format==="MTGO"){const e=/([0-9]+) (.+)/g,a=o.text.matchAll(e);for(const r of a)t[r[2]]={name:r[2],count:r[1],set:"",number:""}}I(t)},P=oe(null),ee=async n=>{if(P.value.files.length===0)return;let t=P.value.files[0];const e=new FileReader;o.active=!0,o.progress=0;let a=null;o.format==="DragonShield Web"&&(a=te),e.onload=async()=>{let d=await a(e.result);I(d)};let r=await Y(t);e.readAsText(t,r)};D.parsePromise=n=>new Promise((t,e)=>{D.parse(n,{header:!0,worker:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:t,error:e})});const te=async n=>{n=n.replace('"sep=,"',"");let t=await D.parsePromise(n),e={};return t.data.forEach(a=>{e[a["Set Code"]+a["Card Number"]]={name:a["Card Name"],count:a.Quantity,set:a["Set Code"].toLowerCase(),number:a["Card Number"].toString()}}),e},I=async n=>{const t=[],e={};try{Object.keys(n).forEach(d=>{let _=n[d],x={};_.set===""&&_.number===""?(x.name=_.name,e[_.name]=_.count):(x.set=_.set,x.collector_number=_.number,e[_.set+_.number]=_.count),t.push(x)});let a=[];o.total=t.length;for(let d=0;d<t.length;d+=75){let x=(await X(b,{identifiers:t.slice(d,d+75)})).data.map(k=>(k.count=e[k.name]||e[k.set+k.collector_number],k));a=a.concat(x),o.count=d,o.progress=d/t.length*100,await new Promise(k=>setTimeout(k,100))}o.progress=100;let r=o.name;y.collections.put({name:r,cards:a}),w.collections.includes(r)||w.collections.push(r),V.value=r}catch{}finally{o.active=!1,o.count=0,o.progress=0,o.total=0,o.show=!1}};return(n,t)=>(c(),m("div",pe,[l("div",fe,[l("div",he,[_e,S(s(U),{modelValue:s(V).value,"onUpdate:modelValue":t[0]||(t[0]=e=>s(V).value=e),options:s(w).collections,mode:"single",canClear:!1},null,8,["modelValue","options"]),l("button",{class:"small add",onClick:t[1]||(t[1]=e=>s(o).show=!0)},"+"),l("button",{class:"small remove",onClick:t[2]||(t[2]=e=>Q(s(V).value))},"-")]),l("div",ye,[ve,S(s(U),{modelValue:s(G).value,"onUpdate:modelValue":t[3]||(t[3]=e=>s(G).value=e),options:s(h).allSets,label:"name",valueProp:"code",searchable:!0,mode:"single",onSelect:J},null,8,["modelValue","options"])]),ge,l("div",be,[we,(c(),m(F,null,A(i,e=>l("div",{class:K(["input-group colour",s(u).colours.includes(e)?"selected":""]),"data-colour":e,key:e},[M(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=a=>s(u).colours=a),value:e,id:e},null,8,Ce),[[z,s(u).colours]]),l("label",{for:e,class:K("icon icon-"+e)},null,10,Ve)],10,ke)),64))]),l("div",xe,[Se,(c(),m(F,null,A(f,e=>l("div",{class:"input-group rarity","data-rarity":e,key:e},[M(l("input",{type:"checkbox","onUpdate:modelValue":a=>s(u).rarity=a,value:e,id:e},null,8,Ue),[[z,s(u).rarity]]),l("label",{for:e,title:e},null,8,Me)],8,Te)),64))]),l("div",Ne,[Le,M(l("input",{type:"search","onUpdate:modelValue":t[5]||(t[5]=e=>s(u).name=e)},null,512),[[E,s(u).name]])]),l("div",Pe,[Ee,S(s(le),{modelValue:s(u).mana,"onUpdate:modelValue":t[6]||(t[6]=e=>s(u).mana=e),min:0,max:20},null,8,["modelValue"])]),l("div",Oe,[De,S(s(U),{modelValue:s(u).keywords,"onUpdate:modelValue":t[7]||(t[7]=e=>s(u).keywords=e),options:s(h).keywords,searchable:!0,mode:"tags"},null,8,["modelValue","options"])]),l("div",Fe,[Ae,S(s(U),{modelValue:s(u).tribes,"onUpdate:modelValue":t[8]||(t[8]=e=>s(u).tribes=e),options:s(h).tribes,searchable:!0,mode:"tags","create-option":!0},null,8,["modelValue","options"])]),l("div",Ge,[Be,M(l("input",{type:"search","onUpdate:modelValue":t[9]||(t[9]=e=>s(u).cardText=e)},null,512),[[E,s(u).cardText]])]),l("div",je,[Re,S(s(U),{modelValue:s(u).sets,"onUpdate:modelValue":t[10]||(t[10]=e=>s(u).sets=e),options:s(h).sets,label:"setName",valueProp:"set",searchable:!0,mode:"tags"},null,8,["modelValue","options"])])]),l("div",We,[s(o).show?(c(),m("div",Ie,[l("button",{class:"small close",onClick:t[11]||(t[11]=e=>s(o).show=!1)},qe),l("div",Ke,[ze,M(l("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>s(o).name=e)},null,512),[[E,s(o).name]]),He,S(s(U),{modelValue:s(o).format,"onUpdate:modelValue":t[13]||(t[13]=e=>s(o).format=e),options:["DragonShield Web","DragonShield Mobile","MTGA","MTGO"],canClear:!1},null,8,["modelValue"]),["MTGA","MTGO"].includes(s(o).format)?M((c(),m("textarea",{key:0,"onUpdate:modelValue":t[14]||(t[14]=e=>s(o).text=e)},null,512)),[[E,s(o).text]]):v("",!0),["DragonShield Web","DragonShield Mobile"].includes(s(o).format)?(c(),m("label",Je,"Choose file")):v("",!0),s(o).format==="DragonShield Web"?(c(),m("input",{key:2,id:"file-input",ref_key:"fileElem",ref:P,type:"file",disabled:s(o).active},null,8,Qe)):v("",!0),!s(o).active&&s(o).format&&(s(o).text||P.value)?(c(),m("div",Xe,[l("button",{onClick:t[15]||(t[15]=e=>["MTGA","MTGO"].includes(s(o).format)?Z():ee())},"Upload")])):v("",!0),s(o).active?(c(),m("div",Ye,[l("span",null,"Processing cards: "+N(s(o).count)+" / "+N(s(o).total),1),l("div",{class:"bar",style:ae({width:s(o).progress+"%"})},null,4)])):v("",!0)])])):v("",!0),s(o).show?v("",!0):(c(),m("div",Ze,[(c(!0),m(F,null,A(s(w).value,e=>(c(),m("div",{class:"card",key:e.id+e.foil},[e.image_uris?(c(),m("img",{key:0,src:e.image_uris.normal},null,8,et)):v("",!0),e.card_faces&&e.card_faces[0].image_uris?(c(),m("img",{key:1,class:"flip front",src:e.card_faces[0].image_uris.normal},null,8,tt)):v("",!0),e.card_faces&&e.card_faces[0].image_uris?(c(),m("img",{key:2,class:"flip back",src:e.card_faces[1].image_uris.normal},null,8,st)):v("",!0),l("p",ot,N(e.count)+" "+N(e.name),1),l("p",null,N(e.set_name),1),l("p",null,N(new Intl.NumberFormat("en-GB",{style:"currency",currency:"EUR"}).format(e.prices.eur)),1)]))),128))]))])]))}};var at=me(lt,[["__scopeId","data-v-49c3d002"]]);const nt={setup(g){return(b,o)=>(c(),ue(at))}},rt=ce(nt);rt.mount("#app");
